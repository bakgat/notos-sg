(function () {
    'use strict';

    angular
        .module('notos', [
            //shared modules
            'notos.core',
            'notos.layout',
            'notos.data',
            'notos.widgets',

            //app modules
            'notos.dashboard',
            'notos.websites',
            'notos.filter'
        ]);
})();
angular
    .module('notos.core', [
        //Angular
        'ngAnimate', 'ngSanitize', 'ngResource',

        //3rd party
        'ui.bootstrap',
        'ncy-angular-breadcrumb',
        'restangular',

        //cross app modules
        'blocks.exception',
        'blocks.logger',
        'blocks.router'
    ]);
(function () {
    'use strict';

    angular
        .module('notos.dashboard', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.data', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.filter', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.layout', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.websites', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.widgets', []);
})();
(function () {
    'use strict';

    angular
        .module('blocks.exception', ['blocks.logger']);
})();
(function () {
    'use strict';

    angular
        .module('blocks.logger', []);
})();
(function () {
    'use strict';

    angular
        .module('blocks.router', [
            'ui.router'
        ]);
})();
/**
 * notos.core
 * FACTORY: Base64
 */

(function () {
    'use strict';

    angular
        .module('notos.core')
        .factory('Base64', Base64);

    /* @ngInject */
    function Base64() {
        var keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
        var service = {
            encode: encode,
            decode: decode
        }

        return service;
        ////////////////

        function encode(input) {
            var output = "";
            var chr1, chr2, chr3 = "";
            var enc1, enc2, enc3, enc4 = "";
            var i = 0;

            do {
                chr1 = input.charCodeAt(i++);
                chr2 = input.charCodeAt(i++);
                chr3 = input.charCodeAt(i++);

                enc1 = chr1 >> 2;
                enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
                enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
                enc4 = chr3 & 63;

                if (isNaN(chr2)) {
                    enc3 = enc4 = 64;
                } else if (isNaN(chr3)) {
                    enc4 = 64;
                }

                output = output +
                    keyStr.charAt(enc1) +
                    keyStr.charAt(enc2) +
                    keyStr.charAt(enc3) +
                    keyStr.charAt(enc4);
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
            } while (i < input.length);

            return output;
        }

        function decode(input) {
            var output = "";
            var chr1, chr2, chr3 = "";
            var enc1, enc2, enc3, enc4 = "";
            var i = 0;

            // remove all characters that are not A-Z, a-z, 0-9, +, /, or =
            var base64test = /[^A-Za-z0-9\+\/\=]/g;
            if (base64test.exec(input)) {
                window.alert("There were invalid base64 characters in the input text.\n" +
                    "Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\n" +
                    "Expect errors in decoding.");
            }
            input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

            do {
                enc1 = keyStr.indexOf(input.charAt(i++));
                enc2 = keyStr.indexOf(input.charAt(i++));
                enc3 = keyStr.indexOf(input.charAt(i++));
                enc4 = keyStr.indexOf(input.charAt(i++));

                chr1 = (enc1 << 2) | (enc2 >> 4);
                chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
                chr3 = ((enc3 & 3) << 6) | enc4;

                output = output + String.fromCharCode(chr1);

                if (enc3 != 64) {
                    output = output + String.fromCharCode(chr2);
                }
                if (enc4 != 64) {
                    output = output + String.fromCharCode(chr3);
                }

                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";

            } while (i < input.length);

            return output;
        }
    };
})();
/**
 * notos.core
 * FACTORY: common
 */

(function () {
    'use strict';

    angular
        .module('notos.core')
        .factory('common', common);

    function common($q, $rootScope, $timeout, logger) {

        var service = {
            // common angular dependencies
            $broadcast: $broadcast,
            $q: $q,
            $timeout: $timeout,
            // generic
            isNumber: isNumber,
            logger: logger,
            textContains: textContains
        }

        return service;
        ////////////////////////

        function $broadcast() {
            return $rootScope.$broadcast.apply($rootScope, arguments);
        }


        function isNumber(val) {
            // negative or positive
            return (/^[-]?\d+$/).test(val);
        }

        function textContains(text, searchText) {
            return text && -1 !== text.toLowerCase().indexOf(searchText.toLowerCase());
        }
    }
    common.$inject = ["$q", "$rootScope", "$timeout", "logger"];
})();
(function () {
    'use strict';

    var core = angular.module('notos.core');

    core.config(toastrConfig);

    /* @ngInject */
    function toastrConfig(toastr) {
        toastr.options.timeOut = 4000;
        toastr.options.closeButton = true;
        toastr.options.progressBar = true;
        toastr.options.positionClass = 'toast-bottom-right';
    }
    toastrConfig.$inject = ["toastr"];

    var config = {
        appErrorPrefix: '[Fout] ',
        appTitle: 'noTos',
        version: '1.0.0'
    };

    core.value('config', config);

    core.config(configure);

    core.run(afterViewContentLoaded);

    core.run(set404);


    /* @ngInject */
    function configure($urlRouterProvider, $stateProvider,
                       routehelperConfigProvider, $breadcrumbProvider,
                       RestangularProvider) {

        configureRouting();
        configureBreadcrumb();

        configureRestangular();

        function configureRouting() {
            routehelperConfigProvider.config.$urlRouterProvider = $urlRouterProvider;
            routehelperConfigProvider.config.$stateProvider = $stateProvider;

            routehelperConfigProvider.config.title = config.appTitle;
        }

        function configureBreadcrumb() {
            $breadcrumbProvider.setOptions({
                prefixStateName: 'index',
                template: 'bootstrap3',
                includeAbstract: true
            });
        }

        function configureRestangular() {
            var baseUrl = '/api';

            RestangularProvider.setBaseUrl(baseUrl);
        }


    }
    configure.$inject = ["$urlRouterProvider", "$stateProvider", "routehelperConfigProvider", "$breadcrumbProvider", "RestangularProvider"];

    /* @ngInject */
    function afterViewContentLoaded($rootScope) {
        $rootScope.$on('$viewContentLoaded',function(){
            angular.element('html, body').animate({ scrollTop: 0 }, 200);
        })
    }
    afterViewContentLoaded.$inject = ["$rootScope"];

    /* @ngInject */
    function set404($rootScope) {
        $rootScope.$on('$stateChangeError', function(event) {
            event.preventDefault();
            $state.go('error.404');
        });
    }
    set404.$inject = ["$rootScope"];

})();
/* global toastr:false, moment:false */
(function() {
    'use strict';

    angular
        .module('notos.core')
        .constant('toastr', toastr)
        .constant('moment', moment)
        .constant('_', window._);
})();
/**
 * ROUTES: notos.core
 */
(function () {
    'use strict';

    angular
        .module('notos.core')
        .run(configRoutes);

    /* @ngInject */
    function configRoutes(routehelper) {
        routehelper.configureStates(getStates());
    }
    configRoutes.$inject = ["routehelper"];;

    function getStates() {
        return [
            {
                state: 'error',
                config: {
                    abstract: true,
                    url: '/error',
                    views: {
                        'main@': {
                            templateUrl: 'js/modules/layout/main.html'
                        }
                    },
                    title: 'Fout'
                }
            },
            {
                state: 'error.404',
                config: {
                    url: '/404',
                    views: {
                        'content@error': {
                            templateUrl: 'js/modules/core/errors/404.html'
                        },
                    },
                    title: 'Pagina niet gevonden'
                }
            }
        ];
    };
})();
/**
 * notos.dashboard
 * CONTROLLER: DashboardController
 */
(function () {
    'use strict';

    angular
        .module('notos.dashboard')
        .controller('DashboardController', DashboardController);

    /* @ngInject */
    function DashboardController($scope, Tag, Website, Level,
                                 SearchWebsiteFilter, $filter) {
        /*jshint validthis: true */
        var rnd = -1;
        var vm = this;

        vm.websites = [];
        vm.filtered = [];
        vm.tags = [];
        vm.levels = [];

        vm.filter = {
            levels: [],
            tags: [],
            terms: ''
        }

        vm.addLevelFilter = addLevelFilter;
        vm.removeLevelFilter = removeLevelFilter;
        vm.addTagFilter = addTagFilter;
        vm.removeTagFilter = removeTagFilter;

        vm.randomSite = null;
        vm.tagLimit = 3;
        vm.levelLimit = 3;

        vm.filterFlag = false;

        vm.itemsPerPage = 10;
        vm.currentPage = 1;
        vm.totalItems = 0;

        vm.pageChanged = pageChanged;


        activate();
        ///////////

        function activate() {
            vm.loadingMain = true;
            vm.loadingLevels = true;
            vm.loadingTags = true;

            getTags();
            getLevels();
            getWebsites().then(function () {
                setFilterFlag();
            });


        }

        function getTags() {
            return Tag.getList().then(tagsCompleted);

            function tagsCompleted(response) {
                vm.tags = response;
                vm.loadingTags = false;
                return vm.tags;
            }
        }

        function getLevels() {
            return Level.getList().then(levelCompleted);

            function levelCompleted(response) {
                vm.levels = response;
                vm.loadingLevels = false;
                return vm.levels;
            }
        }

        function getWebsites() {
            return Website.full().then(websitesCompleted);

            function websitesCompleted(response) {
                vm.websites = $filter('orderBy')(response, 'id', true);
                ;


                vm.loadingMain = false;
                return vm.websites;
            }
        }

        function addLevelFilter(level) {
            vm.filter.levels.push(level);
            var index = vm.levels.indexOf(level);
            vm.levels.splice(index, 1);
        }

        function removeLevelFilter(level) {
            vm.levels.push(level);

            var index = vm.filter.levels.indexOf(level);
            vm.filter.levels.splice(index, 1);
        }

        function addTagFilter(tag) {
            vm.filter.tags.push(tag);
            var index = vm.tags.indexOf(tag);
            vm.tags.splice(index, 1);
        }

        function removeTagFilter(tag) {
            vm.tags.push(tag);

            var index = vm.filter.tags.indexOf(tag);
            vm.filter.tags.splice(index, 1);
        }

        $scope.$watch('vm.filter', function (tags) {
            if (vm.websites.length) {
                vm.filtered = SearchWebsiteFilter(vm.websites, vm.filter);
            }
            setFilterFlag();
        }, true);

        $scope.$watchGroup(['vm.currentPage', 'vm.totalItems', 'vm.itemsPerPage'], function () {
            setPaginationText();
        });


        function setFilterFlag() {
            vm.filterFlag = vm.filter.levels.length ||
                vm.filter.tags.length ||
                vm.filter.terms;

            if (!vm.filterFlag) {
                vm.filtered = vm.websites;
            }
            vm.totalItems = vm.filtered.length;

            setPaginationText();
        }

        function setPaginationText() {
            var total = vm.filtered.length;
            var floor = ((vm.currentPage - 1) * vm.itemsPerPage) + 1;
            var ceil = floor + (vm.itemsPerPage - 1);
            if (ceil > total) {
                ceil = total;
            }

            if (total > 0 && total > vm.itemsPerPage) {
                vm.paginationText = 'Toont ' + floor +
                    (total > 1 ? ' - ' + ' ' + ceil : '') +
                    ' (van ' + total + ' websites)';
            } else {
                vm.paginationText = '';
            }
        }

        $scope.$watch('vm.websites', function () {
            if (vm.websites.length) {
                setRandomSite();
            }
        });
        function setRandomSite() {
            while (!vm.randomSite || !vm.randomSite.image) {
                rnd = Math.floor((Math.random() * vm.websites.length));
                vm.randomSite = vm.websites[rnd];
            }
            return vm.randomSite;
        }

        function pageChanged() {
            angular.element('html, body').animate({ scrollTop: 0 }, 500);
        }
    }
    DashboardController.$inject = ["$scope", "Tag", "Website", "Level", "SearchWebsiteFilter", "$filter"];
})();
/**
 * ROUTES: notos.dashboard
 */
(function () {
    'use strict';

    angular
        .module('notos.dashboard')
        .run(configRoutes);

    /* @ngInject */
    function configRoutes(routehelper) {
        routehelper.configureStates(getStates());
    }
    configRoutes.$inject = ["routehelper"];;

    function getStates() {
        return [
            {
                state: 'index',
                config: {
                    abstract: true,
                    url: '/index',
                    views: {
                        'main@': {
                            templateUrl: 'js/modules/layout/main.html'
                        }
                    },
                    title: 'start'
                }
            },
            {
                state: 'index.dashboard',
                config: {
                    url: '/dashboard',
                    views: {
                        'content@index': {
                            templateUrl: 'js/modules/dashboard/dashboard.html',
                            controller: 'DashboardController',
                            controllerAs: 'vm'
                        }
                    },
                    title: 'Dashboard'
                }
            }
        ];
    };
})();
/**
 * notos.data
 * FILTER: Highlight
 */
(function () {
    'use strict';

    angular
        .module('notos.data')
        .filter('Highlight', Highlight);

    /**
     *
     */
    function Highlight($sce) {
        return function (str, termsToHighlight) {
            if (termsToHighlight === '') {
                return $sce.trustAsHtml(str);
            }
            // Sort terms by length
            termsToHighlight = termsToHighlight.split(" ");
            termsToHighlight.sort(function (a, b) {
                return b.length - a.length;
            });

            // Regex to simultaneously replace terms
            var regex = new RegExp('(?!<[^>]*?>)' + termsToHighlight.join('|') + '(?![^<]*?</[^>]*?>)', 'gi');
            return $sce.trustAsHtml(str.replace(regex, '<span class="match">$&</span>'));
        };
    }
    Highlight.$inject = ["$sce"];

})();
/**
 * notos.data
 * FACTORY: HTTPCache
 */

(function () {
    'use strict';

    angular
        .module('notos.data')
        .factory('HTTPCache', HTTPCache);

    /* @ngInject */
    function HTTPCache(Restangular, $cacheFactory) {
        var cache;
        cache = $cacheFactory('http');

        return Restangular.withConfig(function (RestangularConfigurer) {
            RestangularConfigurer.setDefaultHttpFields({cache: cache});
            RestangularConfigurer.setResponseInterceptor(function (response, operation) {
                if (operation === 'put' || operation === 'post' || operation === 'delete') {
                    cache.removeAll();
                }
                return response;
            });

            // Custom Global Method(s) for Restangularized Elements.
            RestangularConfigurer.setOnElemRestangularized(function(elem, isCollection) {
                elem.clearCache = function() {
                    cache.removeAll();
                }
                return elem;
            });
        });
    }
    HTTPCache.$inject = ["Restangular", "$cacheFactory"];
})();
/**
 * notos.filter
 * FACTORY: Level
 */

(function () {
    'use strict';

    angular
        .module('notos.filter')
        .factory('Level', Level);

    /* @ngInject */
    function Level(HTTPCache) {
        var service = HTTPCache.service('group').one('levels');

        return service;

    }
    Level.$inject = ["HTTPCache"];
})();
/**
 * notos.filter
 * FACTORY: Tag
 */

(function () {
    'use strict';

    angular
        .module('notos.filter')
        .factory('Tag', Tag);

    /* @ngInject */
    function Tag(HTTPCache) {
        var service = HTTPCache.service('tags');

        return service;
    }
    Tag.$inject = ["HTTPCache"];
})();
/**
 * notos.layout
 * CONTROLLER: ShellController
 */
(function () {
    'use strict';

    angular
        .module('notos.layout')
        .controller('ShellController', ShellController);

    /* @ngInject */
    function ShellController() {
        /*jshint validthis: true */
        var vm = this;


        activate();
        /////////////


        function activate() {

        }


    }


})();
/**
 * notos.websites
 * FILTER: SearchWebsite
 */
(function () {
    'use strict';

    angular
        .module('notos.websites')
        .filter('SearchWebsite', SearchWebsite);

    /**
     *
     */
    function SearchWebsite(_) {
        return function (websites, filter) {
            var filtered = [];
            var terms = filter.terms === '' ? null : filter.terms.split(' ');
            var tags = filter.tags;
            var levels = filter.levels;

            var tmp = [];

            angular.forEach(websites, function (website) {
                //FIRST filter by Tags AND Levels (AND operator)
                //check tags
                if (tags.length) {
                    angular.forEach(website.tags, function (tag) {
                        //tag selected
                        if (_.some(tags, function (t) {
                                return t.id === tag.id;
                            })) {
                            addUnique(website, tmp);
                        }
                    });
                }
            });

            websites = tags.length ? tmp : websites;
            if (levels.length) {
                tmp = [];
                angular.forEach(websites, function (website) {
                    //check objective levels

                    if (_.any(levels, function (level) {
                            return _.any(website.objectives, function (objective) {
                                return _.some(objective.levels, function (l) {
                                    return l.level > 0 && l.group.id === level.id;
                                })
                            });
                        })) {
                        addUnique(website, tmp);
                    }
                });
            }

            //Within these results filter by terms (OR operator)
            websites = tags.length || levels.length ? tmp : websites;
            if (terms) {
                angular.forEach(websites, function (website) {
                        //check name and description
                        if (_.some(terms, function (t) {
                                return nameContainsTerm(website.name, t) ||
                                    descriptionContainsTerm(website.description, t) ||
                                    objectivesContainsTerm(website.objectives, t);
                            })) {
                            addUnique(website, filtered);
                        }
                    }
                );
            } else {
                filtered = tmp;
            }

            return filtered;

            function addUnique(website, list) {
                if (list.indexOf(website) === -1) {
                    list.push(website);
                }
            }

            function nameContainsTerm(name, term) {
                return name && _.contains(name.toLowerCase(), term.toLowerCase());
            }

            function descriptionContainsTerm(description, term) {
                return description && _.contains(description.toLowerCase(), term.toLowerCase());
            }

            function objectivesContainsTerm(objectives, term) {
                return _.some(objectives, function (o) {
                    return o && (_.contains(o.code.toLowerCase(), term.toLowerCase()) ||
                        _.contains(o.name.toLowerCase(), term.toLowerCase()));
                });
            }
        }


    }
    SearchWebsite.$inject = ["_"];
})
();
/**
 * notos.websites
 * FACTORY: Website
 */

(function () {
    'use strict';

    angular
        .module('notos.websites')
        .factory('Website', Website);

    /* @ngInject */
    function Website(HTTPCache) {

        var service = {
            full: full,
            getList: getList
        };

        return service;
        ///////////////////

        function getList() {
            return HTTPCache.service('websites').getList();
        }

        function full() {
            return HTTPCache.service('websites').one('full').getList();
        }
    }
    Website.$inject = ["HTTPCache"];
})();
// Include in index.html so that app level exceptions are handled.
// Exclude from testRunner.html which should run exactly what it wants to run
(function() {
    'use strict';

    angular
        .module('blocks.exception')
        .provider('exceptionHandler', exceptionHandlerProvider)
        .config(config);

    /**
     * Must configure the exception handling
     * @return {[type]}
     */
    function exceptionHandlerProvider() {
        /* jshint validthis:true */
        this.config = {
            appErrorPrefix: undefined
        };

        this.configure = function (appErrorPrefix) {
            this.config.appErrorPrefix = appErrorPrefix;
        };

        this.$get = function() {
            return {config: this.config};
        };
    }

    /**
     * Configure by setting an optional string value for appErrorPrefix.
     * Accessible via config.appErrorPrefix (via config value).
     * @param  {[type]} $provide
     * @return {[type]}
     * @ngInject
     */
    function config($provide) {
        $provide.decorator('$exceptionHandler', extendExceptionHandler);
    }
    config.$inject = ["$provide"];

    /**
     * Extend the $exceptionHandler service to also display a toast.
     * @param  {Object} $delegate
     * @param  {Object} exceptionHandler
     * @param  {Object} logger
     * @return {Function} the decorated $exceptionHandler service
     */
    function extendExceptionHandler($delegate, exceptionHandler, logger) {
        return function(exception, cause) {
            var appErrorPrefix = exceptionHandler.config.appErrorPrefix || '';
            var errorData = {exception: exception, cause: cause};
            exception.message = appErrorPrefix + exception.message;
            $delegate(exception, cause);
            /**
             * Could add the error to a service's collection,
             * add errors to $rootScope, log errors to remote web server,
             * or log locally. Or throw hard. It is entirely up to you.
             * throw exception;
             *
             * @example
             *     throw { message: 'error message we added' };
             */
            logger.error(exception.message, errorData);
        };
    }
    extendExceptionHandler.$inject = ["$delegate", "exceptionHandler", "logger"];
})();
/**
 * blocks.exception
 * FACTORY: exception
 */

(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .factory('exception', exception);

    /* @ngInject */
    function exception(logger) {
        var service = {
            catcher: catcher
        };
        return service;

        function catcher(message) {
            return function(reason) {
                logger.error(message, reason);
            };
        }
    }
    exception.$inject = ["logger"];
})();
/**
 * blocks.logger
 * FACTORY: logger
 */

(function () {
    'use strict';

    angular
        .module('blocks.logger')
        .factory('logger', logger);

    logger.$inject = ['$log', 'toastr'];

    function logger($log, toastr) {
        var service = {
            showToasts: true,

            error: error,
            info: info,
            success: success,
            warning: warning,

            removed: removed,
            saved: saved,

            // straight to console; bypass toastr
            log: $log.log
        };

        return service;
        /////////////////////

        function error(message, data, title) {
            toastr.error(message, title);
            $log.error('Fout: ' + message, data);
        }

        function info(message, data, title) {
            toastr.info(message, title);
            $log.info('Info: ' + message, data);
        }

        function success(message, data, title) {
            toastr.success(message, title);
            $log.info('Succes: ' + message, data);
        }

        function warning(message, data, title) {
            toastr.warning(message, title);
            $log.warn('Let op: ' + message, data);
        }

        function removed(message, data, title) {
            toastr.warning(message, title);
            $log.warn('Verwijderd: ' + message, data);
        }

        function saved(message, data, title) {
            toastr.success(message, title);
            $log.info('Bewaard: ' + message, data);
        }
    }
})();
/**
 * notosplus.router
 * FACTORY: routehelper
 */

(function () {
    'use strict';

    angular
        .module('blocks.router')
        .provider('routehelperConfig', routehelperConfig)
        .factory('routehelper', routehelper);

    routehelper.$inject = ['routehelperConfig', '$rootScope', '$state'];

    function routehelperConfig() {
        /* jshint validthis:true */
        this.config = {};

        this.$get = function () {
            return {
                config: this.config
            };
        };
    }

    function routehelper(routehelperConfig, $rootScope, $state) {
        var $urlRouterProvider = routehelperConfig.config.$urlRouterProvider;
        var $stateProvider = routehelperConfig.config.$stateProvider;

        var service = {
            configureStates: configureStates,
            states: states,
            get: get
        };

        init();

        return service;
        //////////////////

        function configureStates(states) {
            states.forEach(function (state) {
                if (state.config.title) {
                    state.config.ncyBreadcrumb = {
                        label: state.config.title.toLowerCase()
                    }
                }

                $stateProvider.state(state.state, state.config);
            });
        }

        function states() {
            return $state.get();
        }

        function get(pattern) {
            var result = null;
            states().forEach(function (state) {
                if (state.name === pattern) {
                    result = state;
                }
            });
            return result;
        }

        function init() {
            updateDocTitle();
            $urlRouterProvider.otherwise('/index/dashboard');
        }

        function updateDocTitle() {
            $rootScope.$on('$stateChangeSuccess',
                function (event, current, previous) {
                    var title = routehelperConfig.config.title + (current.title ? ' | ' + current.title : '');
                    $rootScope.title = title; // data bind to <title>
                    $rootScope.$state = current;
                }
            );
        }

    }
})();
/**
 * notos.widgets
 * DIRECTIVE: ntFa
 */
(function () {
    'use strict';

    angular
        .module('notos.widgets')
        .directive('ntFa', ntFa);

    ntFa.$inject = [];

    function ntFa() {
        var directive = {
            restrict: 'E',
            link: linkFunc
        };

        return directive;
        //////////////////////

        function linkFunc(scope, element, attrs) {
            var i = angular.element('<i class="fa" />');
            var classes = attrs.name.split(' ');

            angular.forEach(classes, function (value) {
                i.addClass('fa-' + value);
            });

            element.replaceWith(i);
        }
    }
})();


/**
 * notos.widgets
 * DIRECTIVE: ntPagination
 */
(function () {
    'use strict';

    angular
        .module('notos.widgets')
        .directive('ntPagination', ntPagination);

    /* @ngInject */
    function ntPagination($compile) {
        var directive = {
            restrict: 'EA',
            scope: {
                totalItems: '=',
                itemsPerPage: '=',
                currentPage: '='
            },
            link: linkFunc,
            controller: PaginateController,
            controllerAs: 'vm',
            bindToController: true // because the scope is isolated
        };

        PaginateController.$inject = ["$scope"];
        return directive;
        //////////////////////

        function linkFunc(scope, element, attrs) {
            var pagination = angular.element('<pagination />')
            pagination.attr('data-boundary-links', true);
            pagination.attr('data-total-items', 'totalItems');
            pagination.attr('data-items-per-page', 'itemsPerPage');
            pagination.attr('data-max-size', 5);
            pagination.attr('data-ng-model', 'currentPage');
            pagination.attr('data-previous-text', '‹');
            pagination.attr('data-next-text', '›');
            pagination.attr('data-first-text', '«');
            pagination.attr('data-last-text', '»');
            pagination.attr('data-ng-hide', 'hide');
            if (attrs['class']) {
                pagination.attr('class', attrs['class']);
            }

            $compile(pagination)(scope);
            element.replaceWith(pagination);
        }

        /* @ngInject */
        function PaginateController($scope) {
            var vm = this;

            vm.hide = false;
            vm.itemsPerPage = 10;
            vm.currentPge = 0;

            $scope.$watch('vm.totalItems', function () {
                vm.hide = (vm.totalItems <= vm.itemsPerPage);
            });
        }
    }
    ntPagination.$inject = ["$compile"];
})();


/**
 * notos.widgets
 * FILTER: offset
 */
(function () {
    'use strict';

    angular
        .module('notos.widgets')
        .filter('offset', filter);


    function filter() {
        return function offset(input, start) {
            if (input) {
                start = parseInt(start, 10);
                return input.slice(start);
            }
            return [];
        };
    }
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vdG9zLm1vZHVsZS5qcyIsImNvcmUvY29yZS5tb2R1bGUuanMiLCJkYXNoYm9hcmQvZGFzaGJvYXJkLm1vZHVsZS5qcyIsImRhdGEvZGF0YS5tb2R1bGUuanMiLCJmaWx0ZXIvZmlsdGVyLm1vZHVsZS5qcyIsImxheW91dC9sYXlvdXQubW9kdWxlLmpzIiwid2Vic2l0ZXMvd2Vic2l0ZXMubW9kdWxlLmpzIiwid2lkZ2V0cy93aWRnZXRzLm1vZHVsZS5qcyIsImJsb2Nrcy9leGNlcHRpb24vZXhjZXB0aW9uLm1vZHVsZS5qcyIsImJsb2Nrcy9sb2dnZXIvbG9nZ2VyLm1vZHVsZS5qcyIsImJsb2Nrcy9yb3V0ZXIvcm91dGVyLm1vZHVsZS5qcyIsImNvcmUvYmFzZTY0LmpzIiwiY29yZS9jb21tb24uanMiLCJjb3JlL2NvbmZpZy5qcyIsImNvcmUvY29uc3RhbnRzLmpzIiwiY29yZS9lcnJvci5yb3V0ZXMuanMiLCJkYXNoYm9hcmQvZGFzaGJvYXJkLmNvbnRyb2xsZXIuanMiLCJkYXNoYm9hcmQvZGFzaGJvYXJkLnJvdXRlcy5qcyIsImRhdGEvaGlnaGxpZ2h0LmpzIiwiZGF0YS9yZXN0YW5ndWxhci5jYWNoZS5qcyIsImZpbHRlci9sZXZlbC5qcyIsImZpbHRlci90YWcuanMiLCJsYXlvdXQvc2hlbGwuY29udHJvbGxlci5qcyIsIndlYnNpdGVzL3NlYXJjaFdlYnNpdGUuZmlsdGVyLmpzIiwid2Vic2l0ZXMvd2Vic2l0ZS5qcyIsImJsb2Nrcy9leGNlcHRpb24vZXhjZXB0aW9uLWhhbmRsZXIucHJvdmlkZXIuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5qcyIsImJsb2Nrcy9sb2dnZXIvbG9nZ2VyLmpzIiwiYmxvY2tzL3JvdXRlci9yb3V0ZWhlbHBlci5qcyIsIndpZGdldHMvaWNvbnMvbnRGYS5qcyIsIndpZGdldHMvbmF2aWdhdGlvbi9udFBhZ2luYXRpb24uanMiLCJ3aWRnZXRzL25hdmlnYXRpb24vb2Zmc2V0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxTQUFBOztZQUVBO1lBQ0E7WUFDQTtZQUNBOzs7WUFHQTtZQUNBO1lBQ0E7OztBQ2RBO0tBQ0EsT0FBQSxjQUFBOztRQUVBLGFBQUEsY0FBQTs7O1FBR0E7UUFDQTtRQUNBOzs7UUFHQTtRQUNBO1FBQ0E7O0FDYkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBLG1CQUFBOztBQ0pBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxjQUFBOztBQ0pBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxnQkFBQTs7QUNKQSxDQUFBLFlBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUEsZ0JBQUE7O0FDSkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBLGtCQUFBOztBQ0pBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxpQkFBQTs7QUNKQSxDQUFBLFlBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUEsb0JBQUEsQ0FBQTs7QUNKQSxDQUFBLFlBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUEsaUJBQUE7O0FDSkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBLGlCQUFBO1lBQ0E7Ozs7Ozs7O0FDQUEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBO1NBQ0EsUUFBQSxVQUFBOzs7SUFHQSxTQUFBLFNBQUE7UUFDQSxJQUFBLFNBQUE7UUFDQSxJQUFBLFVBQUE7WUFDQSxRQUFBO1lBQ0EsUUFBQTs7O1FBR0EsT0FBQTs7O1FBR0EsU0FBQSxPQUFBLE9BQUE7WUFDQSxJQUFBLFNBQUE7WUFDQSxJQUFBLE1BQUEsTUFBQSxPQUFBO1lBQ0EsSUFBQSxNQUFBLE1BQUEsTUFBQSxPQUFBO1lBQ0EsSUFBQSxJQUFBOztZQUVBLEdBQUE7Z0JBQ0EsT0FBQSxNQUFBLFdBQUE7Z0JBQ0EsT0FBQSxNQUFBLFdBQUE7Z0JBQ0EsT0FBQSxNQUFBLFdBQUE7O2dCQUVBLE9BQUEsUUFBQTtnQkFDQSxPQUFBLENBQUEsQ0FBQSxPQUFBLE1BQUEsTUFBQSxRQUFBO2dCQUNBLE9BQUEsQ0FBQSxDQUFBLE9BQUEsT0FBQSxNQUFBLFFBQUE7Z0JBQ0EsT0FBQSxPQUFBOztnQkFFQSxJQUFBLE1BQUEsT0FBQTtvQkFDQSxPQUFBLE9BQUE7dUJBQ0EsSUFBQSxNQUFBLE9BQUE7b0JBQ0EsT0FBQTs7O2dCQUdBLFNBQUE7b0JBQ0EsT0FBQSxPQUFBO29CQUNBLE9BQUEsT0FBQTtvQkFDQSxPQUFBLE9BQUE7b0JBQ0EsT0FBQSxPQUFBO2dCQUNBLE9BQUEsT0FBQSxPQUFBO2dCQUNBLE9BQUEsT0FBQSxPQUFBLE9BQUE7cUJBQ0EsSUFBQSxNQUFBOztZQUVBLE9BQUE7OztRQUdBLFNBQUEsT0FBQSxPQUFBO1lBQ0EsSUFBQSxTQUFBO1lBQ0EsSUFBQSxNQUFBLE1BQUEsT0FBQTtZQUNBLElBQUEsTUFBQSxNQUFBLE1BQUEsT0FBQTtZQUNBLElBQUEsSUFBQTs7O1lBR0EsSUFBQSxhQUFBO1lBQ0EsSUFBQSxXQUFBLEtBQUEsUUFBQTtnQkFDQSxPQUFBLE1BQUE7b0JBQ0E7b0JBQ0E7O1lBRUEsUUFBQSxNQUFBLFFBQUEsdUJBQUE7O1lBRUEsR0FBQTtnQkFDQSxPQUFBLE9BQUEsUUFBQSxNQUFBLE9BQUE7Z0JBQ0EsT0FBQSxPQUFBLFFBQUEsTUFBQSxPQUFBO2dCQUNBLE9BQUEsT0FBQSxRQUFBLE1BQUEsT0FBQTtnQkFDQSxPQUFBLE9BQUEsUUFBQSxNQUFBLE9BQUE7O2dCQUVBLE9BQUEsQ0FBQSxRQUFBLE1BQUEsUUFBQTtnQkFDQSxPQUFBLENBQUEsQ0FBQSxPQUFBLE9BQUEsTUFBQSxRQUFBO2dCQUNBLE9BQUEsQ0FBQSxDQUFBLE9BQUEsTUFBQSxLQUFBOztnQkFFQSxTQUFBLFNBQUEsT0FBQSxhQUFBOztnQkFFQSxJQUFBLFFBQUEsSUFBQTtvQkFDQSxTQUFBLFNBQUEsT0FBQSxhQUFBOztnQkFFQSxJQUFBLFFBQUEsSUFBQTtvQkFDQSxTQUFBLFNBQUEsT0FBQSxhQUFBOzs7Z0JBR0EsT0FB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QUEsYUFBQTs7O0lBR0EsU0FBQSxVQUFBLFFBQUE7UUFDQSxJQUFBLFVBQUE7WUFDQSxTQUFBOztRQUVBLE9BQUE7O1FBRUEsU0FBQSxRQUFBLFNBQUE7WUFDQSxPQUFBLFNBQUEsUUFBQTtnQkFDQSxPQUFBLE1BQUEsU0FBQTs7Ozs7Ozs7Ozs7QUNoQkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBO1NBQ0EsUUFBQSxVQUFBOztJQUVBLE9BQUEsVUFBQSxDQUFBLFFBQUE7O0lBRUEsU0FBQSxPQUFBLE1BQUEsUUFBQTtRQUNBLElBQUEsVUFBQTtZQUNBLFlBQUE7O1lBRUEsT0FBQTtZQUNBLE1BQUE7WUFDQSxTQUFBO1lBQ0EsU0FBQTs7WUFFQSxTQUFBO1lBQ0EsT0FBQTs7O1lBR0EsS0FBQSxLQUFBOzs7UUFHQSxPQUFBOzs7UUFHQSxTQUFBLE1BQUEsU0FBQSxNQUFBLE9BQUE7WUFDQSxPQUFBLE1BQUEsU0FBQTtZQUNBLEtBQUEsTUFBQSxXQUFBLFNBQUE7OztRQUdBLFNBQUEsS0FBQSxTQUFBLE1BQUEsT0FBQTtZQUNBLE9BQUEsS0FBQSxTQUFBO1lBQ0EsS0FBQSxLQUFBLFdBQUEsU0FBQTs7O1FBR0EsU0FBQSxRQUFBLFNBQUEsTUFBQSxPQUFBO1lBQ0EsT0FBQSxRQUFBLFNBQUE7WUFDQSxLQUFBLEtBQUEsYUFBQSxTQUFBOzs7UUFHQSxTQUFBLFFBQUEsU0FBQSxNQUFBLE9BQUE7WUFDQSxPQUFBLFFBQUEsU0FBQTtZQUNBLEtBQUEsS0FBQSxhQUFBLFNBQUE7OztRQUdBLFNBQUEsUUFBQSxTQUFBLE1BQUEsT0FBQTtZQUNBLE9BQUEsUUFBQSxTQUFBO1lBQ0EsS0FBQSxLQUFBLGlCQUFBLFNBQUE7OztRQUdBLFNBQUEsTUFBQSxTQUFBLE1BQUEsT0FBQTtZQUNBLE9BQUEsUUFBQSxTQUFBO1lBQ0EsS0FBQSxLQUFBLGNBQUEsU0FBQTs7Ozs7Ozs7O0FDdkRBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFNBQUEscUJBQUE7U0FDQSxRQUFBLGVBQUE7O0lBRUEsWUFBQSxVQUFBLENBQUEscUJBQUEsY0FBQTs7SUFFQSxTQUFBLG9CQUFBOztRQUVBLEtBQUEsU0FBQTs7UUFFQSxLQUFBLE9BQUEsWUFBQTtZQUNBLE9BQUE7Z0JBQ0EsUUFBQSxLQUFBOzs7OztJQUtBLFNBQUEsWUFBQSxtQkFBQSxZQUFBLFFBQUE7UUFDQSxJQUFBLHFCQUFBLGtCQUFBLE9BQUE7UUFDQSxJQUFBLGlCQUFBLGtCQUFBLE9BQUE7O1FBRUEsSUFBQSxVQUFBO1lBQ0EsaUJBQUE7WUFDQSxRQUFBO1lBQ0EsS0FBQTs7O1FBR0E7O1FBRUEsT0FBQTs7O1FBR0EsU0FBQSxnQkFBQSxRQUFBO1lBQ0EsT0FBQSxRQUFBLFVBQUEsT0FBQTtnQkFDQSxJQUFBLE1BQUEsT0FBQSxPQUFBO29CQUNBLE1BQUEsT0FBQSxnQkFBQTt3QkFDQSxPQUFBLE1BQUEsT0FBQSxNQUFBOzs7O2dCQUlBLGVBQUEsTUFBQSxNQUFBLE9BQUEsTUFBQTs7OztRQUlBLFNBQUEsU0FBQTtZQUNBLE9BQUEsT0FBQTs7O1FBR0EsU0FBQSxJQUFBLFNBQUE7WUFDQSxJQUFBLFNBQUE7WUFDQSxTQUFBLFFBQUEsVUFBQSxPQUFBO2dCQUNBLElBQUEsTUFBQSxTQUFBLFNBQUE7b0JBQ0EsU0FBQTs7O1lBR0EsT0FBQTs7O1FBR0EsU0FBQSxPQUFBO1lBQ0E7WUFDQSxtQkFBQSxVQUFBOzs7UUFHQSxTQUFBLGlCQUFBO1lBQ0EsV0FBQSxJQUFBO2dCQUNBLFVBQUEsT0FBQSxTQUFBLFVBQUE7b0JBQ0EsSUFBQSxRQUFBLGtCQUFBLE9BQUEsU0FBQSxRQUFBLFFBQUEsUUFBQSxRQUFBLFFBQUE7b0JBQ0EsV0FBQSxRQUFBO29CQUNBLFdBQUEsU0FBQTs7Ozs7Ozs7Ozs7QUN6RUEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBO1NBQ0EsVUFBQSxRQUFBOztJQUVBLEtBQUEsVUFBQTs7SUFFQSxTQUFBLE9BQUE7UUFDQSxJQUFBLFlBQUE7WUFDQSxVQUFBO1lBQ0EsTUFBQTs7O1FBR0EsT0FBQTs7O1FBR0EsU0FBQSxTQUFBLE9BQUEsU0FBQSxPQUFBO1lBQ0EsSUFBQSxJQUFBLFFBQUEsUUFBQTtZQUNBLElBQUEsVUFBQSxNQUFBLEtBQUEsTUFBQTs7WUFFQSxRQUFBLFFBQUEsU0FBQSxVQUFBLE9BQUE7Z0JBQ0EsRUFBQSxTQUFBLFFBQUE7OztZQUdBLFFBQUEsWUFBQTs7Ozs7Ozs7OztBQzFCQSxDQUFBLFlBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxVQUFBLGdCQUFBOzs7SUFHQSxTQUFBLGFBQUEsVUFBQTtRQUNBLElBQUEsWUFBQTtZQUNBLFVBQUE7WUFDQSxPQUFBO2dCQUNBLFlBQUE7Z0JBQ0EsY0FBQTtnQkFDQSxhQUFBOztZQUVBLE1BQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTtZQUNBLGtCQUFBOzs7O1FBR0EsT0FBQTs7O1FBR0EsU0FBQSxTQUFBLE9BQUEsU0FBQSxPQUFBO1lBQ0EsSUFBQSxhQUFBLFFBQUEsUUFBQTtZQUNBLFdBQUEsS0FBQSx1QkFBQTtZQUNBLFdBQUEsS0FBQSxvQkFBQTtZQUNBLFdBQUEsS0FBQSx1QkFBQTtZQUNBLFdBQUEsS0FBQSxpQkFBQTtZQUNBLFdBQUEsS0FBQSxpQkFBQTtZQUNBLFdBQUEsS0FBQSxzQkFBQTtZQUNBLFdBQUEsS0FBQSxrQkFBQTtZQUNBLFdBQUEsS0FBQSxtQkFBQTtZQUNBLFdBQUEsS0FBQSxrQkFBQTtZQUNBLFdBQUEsS0FBQSxnQkFBQTtZQUNBLElBQUEsTUFBQSxVQUFBO2dCQUNBLFdBQUEsS0FBQSxTQUFBLE1BQUE7OztZQUdBLFNBQUEsWUFBQTtZQUNBLFFBQUEsWUFBQTs7OztRQUlBLFNBQUEsbUJBQUEsUUFBQTtZQUNBLElBQUEsS0FBQTs7WUFFQSxHQUFBLE9BQUE7WUFDQSxHQUFBLGVBQUE7WUFDQSxHQUFBLGFBQUE7O1lBRUEsT0FBQSxPQUFBLGlCQUFBLFlBQUE7Z0JBQ0EsR0FBQSxRQUFBLEdBQUEsY0FBQSxHQUFBOzs7Ozs7Ozs7Ozs7QUN0REEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBO1NBQ0EsT0FBQSxVQUFBOzs7SUFHQSxTQUFBLFNBQUE7UUFDQSxPQUFBLFNBQUEsT0FBQSxPQUFBLE9BQUE7WUFDQSxJQUFBLE9BQUE7Z0JBQ0EsUUFBQSxTQUFBLE9BQUE7Z0JBQ0EsT0FBQSxNQUFBLE1BQUE7O1lBRUEsT0FBQTs7O0tBR0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3RvcycsIFtcbiAgICAgICAgICAgIC8vc2hhcmVkIG1vZHVsZXNcbiAgICAgICAgICAgICdub3Rvcy5jb3JlJyxcbiAgICAgICAgICAgICdub3Rvcy5sYXlvdXQnLFxuICAgICAgICAgICAgJ25vdG9zLmRhdGEnLFxuICAgICAgICAgICAgJ25vdG9zLndpZGdldHMnLFxuXG4gICAgICAgICAgICAvL2FwcCBtb2R1bGVzXG4gICAgICAgICAgICAnbm90b3MuZGFzaGJvYXJkJyxcbiAgICAgICAgICAgICdub3Rvcy53ZWJzaXRlcycsXG4gICAgICAgICAgICAnbm90b3MuZmlsdGVyJ1xuICAgICAgICBdKTtcbn0pKCk7IiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ25vdG9zLmNvcmUnLCBbXG4gICAgICAgIC8vQW5ndWxhclxuICAgICAgICAnbmdBbmltYXRlJywgJ25nU2FuaXRpemUnLCAnbmdSZXNvdXJjZScsXG5cbiAgICAgICAgLy8zcmQgcGFydHlcbiAgICAgICAgJ3VpLmJvb3RzdHJhcCcsXG4gICAgICAgICduY3ktYW5ndWxhci1icmVhZGNydW1iJyxcbiAgICAgICAgJ3Jlc3Rhbmd1bGFyJyxcblxuICAgICAgICAvL2Nyb3NzIGFwcCBtb2R1bGVzXG4gICAgICAgICdibG9ja3MuZXhjZXB0aW9uJyxcbiAgICAgICAgJ2Jsb2Nrcy5sb2dnZXInLFxuICAgICAgICAnYmxvY2tzLnJvdXRlcidcbiAgICBdKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3MuZGFzaGJvYXJkJywgW10pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3MuZGF0YScsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmZpbHRlcicsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmxheW91dCcsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLndlYnNpdGVzJywgW10pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3Mud2lkZ2V0cycsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2Jsb2Nrcy5leGNlcHRpb24nLCBbJ2Jsb2Nrcy5sb2dnZXInXSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdibG9ja3MubG9nZ2VyJywgW10pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLnJvdXRlcicsIFtcbiAgICAgICAgICAgICd1aS5yb3V0ZXInXG4gICAgICAgIF0pO1xufSkoKTsiLCIvKipcbiAqIG5vdG9zLmNvcmVcbiAqIEZBQ1RPUlk6IEJhc2U2NFxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5jb3JlJylcbiAgICAgICAgLmZhY3RvcnkoJ0Jhc2U2NCcsIEJhc2U2NCk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBCYXNlNjQoKSB7XG4gICAgICAgIHZhciBrZXlTdHIgPSAnQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0nO1xuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGVuY29kZTogZW5jb2RlLFxuICAgICAgICAgICAgZGVjb2RlOiBkZWNvZGVcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZW5jb2RlKGlucHV0KSB7XG4gICAgICAgICAgICB2YXIgb3V0cHV0ID0gXCJcIjtcbiAgICAgICAgICAgIHZhciBjaHIxLCBjaHIyLCBjaHIzID0gXCJcIjtcbiAgICAgICAgICAgIHZhciBlbmMxLCBlbmMyLCBlbmMzLCBlbmM0ID0gXCJcIjtcbiAgICAgICAgICAgIHZhciBpID0gMDtcblxuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIGNocjEgPSBpbnB1dC5jaGFyQ29kZUF0KGkrKyk7XG4gICAgICAgICAgICAgICAgY2hyMiA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTtcbiAgICAgICAgICAgICAgICBjaHIzID0gaW5wdXQuY2hhckNvZGVBdChpKyspO1xuXG4gICAgICAgICAgICAgICAgZW5jMSA9IGNocjEgPj4gMjtcbiAgICAgICAgICAgICAgICBlbmMyID0gKChjaHIxICYgMykgPDwgNCkgfCAoY2hyMiA+PiA0KTtcbiAgICAgICAgICAgICAgICBlbmMzID0gKChjaHIyICYgMTUpIDw8IDIpIHwgKGNocjMgPj4gNik7XG4gICAgICAgICAgICAgICAgZW5jNCA9IGNocjMgJiA2MztcblxuICAgICAgICAgICAgICAgIGlmIChpc05hTihjaHIyKSkge1xuICAgICAgICAgICAgICAgICAgICBlbmMzID0gZW5jNCA9IDY0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOYU4oY2hyMykpIHtcbiAgICAgICAgICAgICAgICAgICAgZW5jNCA9IDY0O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCArXG4gICAgICAgICAgICAgICAgICAgIGtleVN0ci5jaGFyQXQoZW5jMSkgK1xuICAgICAgICAgICAgICAgICAgICBrZXlTdHIuY2hhckF0KGVuYzIpICtcbiAgICAgICAgICAgICAgICAgICAga2V5U3RyLmNoYXJBdChlbmMzKSArXG4gICAgICAgICAgICAgICAgICAgIGtleVN0ci5jaGFyQXQoZW5jNCk7XG4gICAgICAgICAgICAgICAgY2hyMSA9IGNocjIgPSBjaHIzID0gXCJcIjtcbiAgICAgICAgICAgICAgICBlbmMxID0gZW5jMiA9IGVuYzMgPSBlbmM0ID0gXCJcIjtcbiAgICAgICAgICAgIH0gd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpO1xuXG4gICAgICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGVjb2RlKGlucHV0KSB7XG4gICAgICAgICAgICB2YXIgb3V0cHV0ID0gXCJcIjtcbiAgICAgICAgICAgIHZhciBjaHIxLCBjaHIyLCBjaHIzID0gXCJcIjtcbiAgICAgICAgICAgIHZhciBlbmMxLCBlbmMyLCBlbmMzLCBlbmM0ID0gXCJcIjtcbiAgICAgICAgICAgIHZhciBpID0gMDtcblxuICAgICAgICAgICAgLy8gcmVtb3ZlIGFsbCBjaGFyYWN0ZXJzIHRoYXQgYXJlIG5vdCBBLVosIGEteiwgMC05LCArLCAvLCBvciA9XG4gICAgICAgICAgICB2YXIgYmFzZTY0dGVzdCA9IC9bXkEtWmEtejAtOVxcK1xcL1xcPV0vZztcbiAgICAgICAgICAgIGlmIChiYXNlNjR0ZXN0LmV4ZWMoaW5wdXQpKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KFwiVGhlcmUgd2VyZSBpbnZhbGlkIGJhc2U2NCBjaGFyYWN0ZXJzIGluIHRoZSBpbnB1dCB0ZXh0LlxcblwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJWYWxpZCBiYXNlNjQgY2hhcmFjdGVycyBhcmUgQS1aLCBhLXosIDAtOSwgJysnLCAnLycsYW5kICc9J1xcblwiICtcbiAgICAgICAgICAgICAgICAgICAgXCJFeHBlY3QgZXJyb3JzIGluIGRlY29kaW5nLlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvW15BLVphLXowLTlcXCtcXC9cXD1dL2csIFwiXCIpO1xuXG4gICAgICAgICAgICBkbyB7XG4gICAgICAgICAgICAgICAgZW5jMSA9IGtleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICAgICAgICAgICAgICBlbmMyID0ga2V5U3RyLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpO1xuICAgICAgICAgICAgICAgIGVuYzMgPSBrZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgICAgICAgICAgICAgZW5jNCA9IGtleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcblxuICAgICAgICAgICAgICAgIGNocjEgPSAoZW5jMSA8PCAyKSB8IChlbmMyID4+IDQpO1xuICAgICAgICAgICAgICAgIGNocjIgPSAoKGVuYzIgJiAxNSkgPDwgNCkgfCAoZW5jMyA+PiAyKTtcbiAgICAgICAgICAgICAgICBjaHIzID0gKChlbmMzICYgMykgPDwgNikgfCBlbmM0O1xuXG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gb3V0cHV0ICsgU3RyaW5nLmZyb21DaGFyQ29kZShjaHIxKTtcblxuICAgICAgICAgICAgICAgIGlmIChlbmMzICE9IDY0KSB7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlbmM0ICE9IDY0KSB7XG4gICAgICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY2hyMSA9IGNocjIgPSBjaHIzID0gXCJcIjtcbiAgICAgICAgICAgICAgICBlbmMxID0gZW5jMiA9IGVuYzMgPSBlbmM0ID0gXCJcIjtcblxuICAgICAgICAgICAgfSB3aGlsZSAoaSA8IGlucHV0Lmxlbmd0aCk7XG5cbiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgICAgIH1cbiAgICB9O1xufSkoKTsiLCIvKipcbiAqIG5vdG9zLmNvcmVcbiAqIEZBQ1RPUlk6IGNvbW1vblxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5jb3JlJylcbiAgICAgICAgLmZhY3RvcnkoJ2NvbW1vbicsIGNvbW1vbik7XG5cbiAgICBmdW5jdGlvbiBjb21tb24oJHEsICRyb290U2NvcGUsICR0aW1lb3V0LCBsb2dnZXIpIHtcblxuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIC8vIGNvbW1vbiBhbmd1bGFyIGRlcGVuZGVuY2llc1xuICAgICAgICAgICAgJGJyb2FkY2FzdDogJGJyb2FkY2FzdCxcbiAgICAgICAgICAgICRxOiAkcSxcbiAgICAgICAgICAgICR0aW1lb3V0OiAkdGltZW91dCxcbiAgICAgICAgICAgIC8vIGdlbmVyaWNcbiAgICAgICAgICAgIGlzTnVtYmVyOiBpc051bWJlcixcbiAgICAgICAgICAgIGxvZ2dlcjogbG9nZ2VyLFxuICAgICAgICAgICAgdGV4dENvbnRhaW5zOiB0ZXh0Q29udGFpbnNcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiAkYnJvYWRjYXN0KCkge1xuICAgICAgICAgICAgcmV0dXJuICRyb290U2NvcGUuJGJyb2FkY2FzdC5hcHBseSgkcm9vdFNjb3BlLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG5cblxuICAgICAgICBmdW5jdGlvbiBpc051bWJlcih2YWwpIHtcbiAgICAgICAgICAgIC8vIG5lZ2F0aXZlIG9yIHBvc2l0aXZlXG4gICAgICAgICAgICByZXR1cm4gKC9eWy1dP1xcZCskLykudGVzdCh2YWwpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gdGV4dENvbnRhaW5zKHRleHQsIHNlYXJjaFRleHQpIHtcbiAgICAgICAgICAgIHJldHVybiB0ZXh0ICYmIC0xICE9PSB0ZXh0LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBjb3JlID0gYW5ndWxhci5tb2R1bGUoJ25vdG9zLmNvcmUnKTtcblxuICAgIGNvcmUuY29uZmlnKHRvYXN0ckNvbmZpZyk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiB0b2FzdHJDb25maWcodG9hc3RyKSB7XG4gICAgICAgIHRvYXN0ci5vcHRpb25zLnRpbWVPdXQgPSA0MDAwO1xuICAgICAgICB0b2FzdHIub3B0aW9ucy5jbG9zZUJ1dHRvbiA9IHRydWU7XG4gICAgICAgIHRvYXN0ci5vcHRpb25zLnByb2dyZXNzQmFyID0gdHJ1ZTtcbiAgICAgICAgdG9hc3RyLm9wdGlvbnMucG9zaXRpb25DbGFzcyA9ICd0b2FzdC1ib3R0b20tcmlnaHQnO1xuICAgIH1cblxuICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgIGFwcEVycm9yUHJlZml4OiAnW0ZvdXRdICcsXG4gICAgICAgIGFwcFRpdGxlOiAnbm9Ub3MnLFxuICAgICAgICB2ZXJzaW9uOiAnMS4wLjAnXG4gICAgfTtcblxuICAgIGNvcmUudmFsdWUoJ2NvbmZpZycsIGNvbmZpZyk7XG5cbiAgICBjb3JlLmNvbmZpZyhjb25maWd1cmUpO1xuXG4gICAgY29yZS5ydW4oYWZ0ZXJWaWV3Q29udGVudExvYWRlZCk7XG5cbiAgICBjb3JlLnJ1bihzZXQ0MDQpO1xuXG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBjb25maWd1cmUoJHVybFJvdXRlclByb3ZpZGVyLCAkc3RhdGVQcm92aWRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgcm91dGVoZWxwZXJDb25maWdQcm92aWRlciwgJGJyZWFkY3J1bWJQcm92aWRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgUmVzdGFuZ3VsYXJQcm92aWRlcikge1xuXG4gICAgICAgIGNvbmZpZ3VyZVJvdXRpbmcoKTtcbiAgICAgICAgY29uZmlndXJlQnJlYWRjcnVtYigpO1xuXG4gICAgICAgIGNvbmZpZ3VyZVJlc3Rhbmd1bGFyKCk7XG5cbiAgICAgICAgZnVuY3Rpb24gY29uZmlndXJlUm91dGluZygpIHtcbiAgICAgICAgICAgIHJvdXRlaGVscGVyQ29uZmlnUHJvdmlkZXIuY29uZmlnLiR1cmxSb3V0ZXJQcm92aWRlciA9ICR1cmxSb3V0ZXJQcm92aWRlcjtcbiAgICAgICAgICAgIHJvdXRlaGVscGVyQ29uZmlnUHJvdmlkZXIuY29uZmlnLiRzdGF0ZVByb3ZpZGVyID0gJHN0YXRlUHJvdmlkZXI7XG5cbiAgICAgICAgICAgIHJvdXRlaGVscGVyQ29uZmlnUHJvdmlkZXIuY29uZmlnLnRpdGxlID0gY29uZmlnLmFwcFRpdGxlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY29uZmlndXJlQnJlYWRjcnVtYigpIHtcbiAgICAgICAgICAgICRicmVhZGNydW1iUHJvdmlkZXIuc2V0T3B0aW9ucyh7XG4gICAgICAgICAgICAgICAgcHJlZml4U3RhdGVOYW1lOiAnaW5kZXgnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnYm9vdHN0cmFwMycsXG4gICAgICAgICAgICAgICAgaW5jbHVkZUFic3RyYWN0OiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZVJlc3Rhbmd1bGFyKCkge1xuICAgICAgICAgICAgdmFyIGJhc2VVcmwgPSAnL2FwaSc7XG5cbiAgICAgICAgICAgIFJlc3Rhbmd1bGFyUHJvdmlkZXIuc2V0QmFzZVVybChiYXNlVXJsKTtcbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBhZnRlclZpZXdDb250ZW50TG9hZGVkKCRyb290U2NvcGUpIHtcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyR2aWV3Q29udGVudExvYWRlZCcsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnaHRtbCwgYm9keScpLmFuaW1hdGUoeyBzY3JvbGxUb3A6IDAgfSwgMjAwKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBzZXQ0MDQoJHJvb3RTY29wZSkge1xuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlRXJyb3InLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICRzdGF0ZS5nbygnZXJyb3IuNDA0Jyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxufSkoKTsiLCIvKiBnbG9iYWwgdG9hc3RyOmZhbHNlLCBtb21lbnQ6ZmFsc2UgKi9cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmNvcmUnKVxuICAgICAgICAuY29uc3RhbnQoJ3RvYXN0cicsIHRvYXN0cilcbiAgICAgICAgLmNvbnN0YW50KCdtb21lbnQnLCBtb21lbnQpXG4gICAgICAgIC5jb25zdGFudCgnXycsIHdpbmRvdy5fKTtcbn0pKCk7IiwiLyoqXG4gKiBST1VURVM6IG5vdG9zLmNvcmVcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmNvcmUnKVxuICAgICAgICAucnVuKGNvbmZpZ1JvdXRlcyk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBjb25maWdSb3V0ZXMocm91dGVoZWxwZXIpIHtcbiAgICAgICAgcm91dGVoZWxwZXIuY29uZmlndXJlU3RhdGVzKGdldFN0YXRlcygpKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ2V0U3RhdGVzKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHN0YXRlOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgICAgICBhYnN0cmFjdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2Vycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtYWluQCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL21vZHVsZXMvbGF5b3V0L21haW4uaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdGb3V0J1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc3RhdGU6ICdlcnJvci40MDQnLFxuICAgICAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvNDA0JyxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdjb250ZW50QGVycm9yJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnanMvbW9kdWxlcy9jb3JlL2Vycm9ycy80MDQuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnUGFnaW5hIG5pZXQgZ2V2b25kZW4nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuICAgIH07XG59KSgpOyIsIi8qKlxuICogbm90b3MuZGFzaGJvYXJkXG4gKiBDT05UUk9MTEVSOiBEYXNoYm9hcmRDb250cm9sbGVyXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5kYXNoYm9hcmQnKVxuICAgICAgICAuY29udHJvbGxlcignRGFzaGJvYXJkQ29udHJvbGxlcicsIERhc2hib2FyZENvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gRGFzaGJvYXJkQ29udHJvbGxlcigkc2NvcGUsIFRhZywgV2Vic2l0ZSwgTGV2ZWwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWFyY2hXZWJzaXRlRmlsdGVyLCAkZmlsdGVyKSB7XG4gICAgICAgIC8qanNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgcm5kID0gLTE7XG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0ud2Vic2l0ZXMgPSBbXTtcbiAgICAgICAgdm0uZmlsdGVyZWQgPSBbXTtcbiAgICAgICAgdm0udGFncyA9IFtdO1xuICAgICAgICB2bS5sZXZlbHMgPSBbXTtcblxuICAgICAgICB2bS5maWx0ZXIgPSB7XG4gICAgICAgICAgICBsZXZlbHM6IFtdLFxuICAgICAgICAgICAgdGFnczogW10sXG4gICAgICAgICAgICB0ZXJtczogJydcbiAgICAgICAgfVxuXG4gICAgICAgIHZtLmFkZExldmVsRmlsdGVyID0gYWRkTGV2ZWxGaWx0ZXI7XG4gICAgICAgIHZtLnJlbW92ZUxldmVsRmlsdGVyID0gcmVtb3ZlTGV2ZWxGaWx0ZXI7XG4gICAgICAgIHZtLmFkZFRhZ0ZpbHRlciA9IGFkZFRhZ0ZpbHRlcjtcbiAgICAgICAgdm0ucmVtb3ZlVGFnRmlsdGVyID0gcmVtb3ZlVGFnRmlsdGVyO1xuXG4gICAgICAgIHZtLnJhbmRvbVNpdGUgPSBudWxsO1xuICAgICAgICB2bS50YWdMaW1pdCA9IDM7XG4gICAgICAgIHZtLmxldmVsTGltaXQgPSAzO1xuXG4gICAgICAgIHZtLmZpbHRlckZsYWcgPSBmYWxzZTtcblxuICAgICAgICB2bS5pdGVtc1BlclBhZ2UgPSAxMDtcbiAgICAgICAgdm0uY3VycmVudFBhZ2UgPSAxO1xuICAgICAgICB2bS50b3RhbEl0ZW1zID0gMDtcblxuICAgICAgICB2bS5wYWdlQ2hhbmdlZCA9IHBhZ2VDaGFuZ2VkO1xuXG5cbiAgICAgICAgYWN0aXZhdGUoKTtcbiAgICAgICAgLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgICAgICAgIHZtLmxvYWRpbmdNYWluID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLmxvYWRpbmdMZXZlbHMgPSB0cnVlO1xuICAgICAgICAgICAgdm0ubG9hZGluZ1RhZ3MgPSB0cnVlO1xuXG4gICAgICAgICAgICBnZXRUYWdzKCk7XG4gICAgICAgICAgICBnZXRMZXZlbHMoKTtcbiAgICAgICAgICAgIGdldFdlYnNpdGVzKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2V0RmlsdGVyRmxhZygpO1xuICAgICAgICAgICAgfSk7XG5cblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VGFncygpIHtcbiAgICAgICAgICAgIHJldHVybiBUYWcuZ2V0TGlzdCgpLnRoZW4odGFnc0NvbXBsZXRlZCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHRhZ3NDb21wbGV0ZWQocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2bS50YWdzID0gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ1RhZ3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdm0udGFncztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldExldmVscygpIHtcbiAgICAgICAgICAgIHJldHVybiBMZXZlbC5nZXRMaXN0KCkudGhlbihsZXZlbENvbXBsZXRlZCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGxldmVsQ29tcGxldGVkKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdm0ubGV2ZWxzID0gcmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ0xldmVscyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybiB2bS5sZXZlbHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRXZWJzaXRlcygpIHtcbiAgICAgICAgICAgIHJldHVybiBXZWJzaXRlLmZ1bGwoKS50aGVuKHdlYnNpdGVzQ29tcGxldGVkKTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gd2Vic2l0ZXNDb21wbGV0ZWQocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2bS53ZWJzaXRlcyA9ICRmaWx0ZXIoJ29yZGVyQnknKShyZXNwb25zZSwgJ2lkJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgO1xuXG5cbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nTWFpbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybiB2bS53ZWJzaXRlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGFkZExldmVsRmlsdGVyKGxldmVsKSB7XG4gICAgICAgICAgICB2bS5maWx0ZXIubGV2ZWxzLnB1c2gobGV2ZWwpO1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gdm0ubGV2ZWxzLmluZGV4T2YobGV2ZWwpO1xuICAgICAgICAgICAgdm0ubGV2ZWxzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZW1vdmVMZXZlbEZpbHRlcihsZXZlbCkge1xuICAgICAgICAgICAgdm0ubGV2ZWxzLnB1c2gobGV2ZWwpO1xuXG4gICAgICAgICAgICB2YXIgaW5kZXggPSB2bS5maWx0ZXIubGV2ZWxzLmluZGV4T2YobGV2ZWwpO1xuICAgICAgICAgICAgdm0uZmlsdGVyLmxldmVscy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWRkVGFnRmlsdGVyKHRhZykge1xuICAgICAgICAgICAgdm0uZmlsdGVyLnRhZ3MucHVzaCh0YWcpO1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gdm0udGFncy5pbmRleE9mKHRhZyk7XG4gICAgICAgICAgICB2bS50YWdzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZW1vdmVUYWdGaWx0ZXIodGFnKSB7XG4gICAgICAgICAgICB2bS50YWdzLnB1c2godGFnKTtcblxuICAgICAgICAgICAgdmFyIGluZGV4ID0gdm0uZmlsdGVyLnRhZ3MuaW5kZXhPZih0YWcpO1xuICAgICAgICAgICAgdm0uZmlsdGVyLnRhZ3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmZpbHRlcicsIGZ1bmN0aW9uICh0YWdzKSB7XG4gICAgICAgICAgICBpZiAodm0ud2Vic2l0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyZWQgPSBTZWFyY2hXZWJzaXRlRmlsdGVyKHZtLndlYnNpdGVzLCB2bS5maWx0ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0RmlsdGVyRmxhZygpO1xuICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoR3JvdXAoWyd2bS5jdXJyZW50UGFnZScsICd2bS50b3RhbEl0ZW1zJywgJ3ZtLml0ZW1zUGVyUGFnZSddLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZXRQYWdpbmF0aW9uVGV4dCgpO1xuICAgICAgICB9KTtcblxuXG4gICAgICAgIGZ1bmN0aW9uIHNldEZpbHRlckZsYWcoKSB7XG4gICAgICAgICAgICB2bS5maWx0ZXJGbGFnID0gdm0uZmlsdGVyLmxldmVscy5sZW5ndGggfHxcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXIudGFncy5sZW5ndGggfHxcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXIudGVybXM7XG5cbiAgICAgICAgICAgIGlmICghdm0uZmlsdGVyRmxhZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlcmVkID0gdm0ud2Vic2l0ZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS50b3RhbEl0ZW1zID0gdm0uZmlsdGVyZWQubGVuZ3RoO1xuXG4gICAgICAgICAgICBzZXRQYWdpbmF0aW9uVGV4dCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0UGFnaW5hdGlvblRleHQoKSB7XG4gICAgICAgICAgICB2YXIgdG90YWwgPSB2bS5maWx0ZXJlZC5sZW5ndGg7XG4gICAgICAgICAgICB2YXIgZmxvb3IgPSAoKHZtLmN1cnJlbnRQYWdlIC0gMSkgKiB2bS5pdGVtc1BlclBhZ2UpICsgMTtcbiAgICAgICAgICAgIHZhciBjZWlsID0gZmxvb3IgKyAodm0uaXRlbXNQZXJQYWdlIC0gMSk7XG4gICAgICAgICAgICBpZiAoY2VpbCA+IHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgY2VpbCA9IHRvdGFsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodG90YWwgPiAwICYmIHRvdGFsID4gdm0uaXRlbXNQZXJQYWdlKSB7XG4gICAgICAgICAgICAgICAgdm0ucGFnaW5hdGlvblRleHQgPSAnVG9vbnQgJyArIGZsb29yICtcbiAgICAgICAgICAgICAgICAgICAgKHRvdGFsID4gMSA/ICcgLSAnICsgJyAnICsgY2VpbCA6ICcnKSArXG4gICAgICAgICAgICAgICAgICAgICcgKHZhbiAnICsgdG90YWwgKyAnIHdlYnNpdGVzKSc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLnBhZ2luYXRpb25UZXh0ID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS53ZWJzaXRlcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh2bS53ZWJzaXRlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBzZXRSYW5kb21TaXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBmdW5jdGlvbiBzZXRSYW5kb21TaXRlKCkge1xuICAgICAgICAgICAgd2hpbGUgKCF2bS5yYW5kb21TaXRlIHx8ICF2bS5yYW5kb21TaXRlLmltYWdlKSB7XG4gICAgICAgICAgICAgICAgcm5kID0gTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIHZtLndlYnNpdGVzLmxlbmd0aCkpO1xuICAgICAgICAgICAgICAgIHZtLnJhbmRvbVNpdGUgPSB2bS53ZWJzaXRlc1tybmRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZtLnJhbmRvbVNpdGU7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBwYWdlQ2hhbmdlZCgpIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnaHRtbCwgYm9keScpLmFuaW1hdGUoeyBzY3JvbGxUb3A6IDAgfSwgNTAwKTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiLyoqXG4gKiBST1VURVM6IG5vdG9zLmRhc2hib2FyZFxuICovXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3MuZGFzaGJvYXJkJylcbiAgICAgICAgLnJ1bihjb25maWdSb3V0ZXMpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gY29uZmlnUm91dGVzKHJvdXRlaGVscGVyKSB7XG4gICAgICAgIHJvdXRlaGVscGVyLmNvbmZpZ3VyZVN0YXRlcyhnZXRTdGF0ZXMoKSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldFN0YXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzdGF0ZTogJ2luZGV4JyxcbiAgICAgICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9pbmRleCcsXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbWFpbkAnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdqcy9tb2R1bGVzL2xheW91dC9tYWluLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnc3RhcnQnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzdGF0ZTogJ2luZGV4LmRhc2hib2FyZCcsXG4gICAgICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9kYXNoYm9hcmQnLFxuICAgICAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2NvbnRlbnRAaW5kZXgnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdqcy9tb2R1bGVzL2Rhc2hib2FyZC9kYXNoYm9hcmQuaHRtbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0Rhc2hib2FyZENvbnRyb2xsZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0Rhc2hib2FyZCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF07XG4gICAgfTtcbn0pKCk7IiwiLyoqXG4gKiBub3Rvcy5kYXRhXG4gKiBGSUxURVI6IEhpZ2hsaWdodFxuICovXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3MuZGF0YScpXG4gICAgICAgIC5maWx0ZXIoJ0hpZ2hsaWdodCcsIEhpZ2hsaWdodCk7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIEhpZ2hsaWdodCgkc2NlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoc3RyLCB0ZXJtc1RvSGlnaGxpZ2h0KSB7XG4gICAgICAgICAgICBpZiAodGVybXNUb0hpZ2hsaWdodCA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbChzdHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gU29ydCB0ZXJtcyBieSBsZW5ndGhcbiAgICAgICAgICAgIHRlcm1zVG9IaWdobGlnaHQgPSB0ZXJtc1RvSGlnaGxpZ2h0LnNwbGl0KFwiIFwiKTtcbiAgICAgICAgICAgIHRlcm1zVG9IaWdobGlnaHQuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgIHJldHVybiBiLmxlbmd0aCAtIGEubGVuZ3RoO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFJlZ2V4IHRvIHNpbXVsdGFuZW91c2x5IHJlcGxhY2UgdGVybXNcbiAgICAgICAgICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoJyg/ITxbXj5dKj8+KScgKyB0ZXJtc1RvSGlnaGxpZ2h0LmpvaW4oJ3wnKSArICcoPyFbXjxdKj88L1tePl0qPz4pJywgJ2dpJyk7XG4gICAgICAgICAgICByZXR1cm4gJHNjZS50cnVzdEFzSHRtbChzdHIucmVwbGFjZShyZWdleCwgJzxzcGFuIGNsYXNzPVwibWF0Y2hcIj4kJjwvc3Bhbj4nKSk7XG4gICAgICAgIH07XG4gICAgfVxuXG59KSgpOyIsIi8qKlxuICogbm90b3MuZGF0YVxuICogRkFDVE9SWTogSFRUUENhY2hlXG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmRhdGEnKVxuICAgICAgICAuZmFjdG9yeSgnSFRUUENhY2hlJywgSFRUUENhY2hlKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIEhUVFBDYWNoZShSZXN0YW5ndWxhciwgJGNhY2hlRmFjdG9yeSkge1xuICAgICAgICB2YXIgY2FjaGU7XG4gICAgICAgIGNhY2hlID0gJGNhY2hlRmFjdG9yeSgnaHR0cCcpO1xuXG4gICAgICAgIHJldHVybiBSZXN0YW5ndWxhci53aXRoQ29uZmlnKGZ1bmN0aW9uIChSZXN0YW5ndWxhckNvbmZpZ3VyZXIpIHtcbiAgICAgICAgICAgIFJlc3Rhbmd1bGFyQ29uZmlndXJlci5zZXREZWZhdWx0SHR0cEZpZWxkcyh7Y2FjaGU6IGNhY2hlfSk7XG4gICAgICAgICAgICBSZXN0YW5ndWxhckNvbmZpZ3VyZXIuc2V0UmVzcG9uc2VJbnRlcmNlcHRvcihmdW5jdGlvbiAocmVzcG9uc2UsIG9wZXJhdGlvbikge1xuICAgICAgICAgICAgICAgIGlmIChvcGVyYXRpb24gPT09ICdwdXQnIHx8IG9wZXJhdGlvbiA9PT0gJ3Bvc3QnIHx8IG9wZXJhdGlvbiA9PT0gJ2RlbGV0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FjaGUucmVtb3ZlQWxsKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBDdXN0b20gR2xvYmFsIE1ldGhvZChzKSBmb3IgUmVzdGFuZ3VsYXJpemVkIEVsZW1lbnRzLlxuICAgICAgICAgICAgUmVzdGFuZ3VsYXJDb25maWd1cmVyLnNldE9uRWxlbVJlc3Rhbmd1bGFyaXplZChmdW5jdGlvbihlbGVtLCBpc0NvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICBlbGVtLmNsZWFyQ2FjaGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FjaGUucmVtb3ZlQWxsKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pKCk7IiwiLyoqXG4gKiBub3Rvcy5maWx0ZXJcbiAqIEZBQ1RPUlk6IExldmVsXG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmZpbHRlcicpXG4gICAgICAgIC5mYWN0b3J5KCdMZXZlbCcsIExldmVsKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIExldmVsKEhUVFBDYWNoZSkge1xuICAgICAgICB2YXIgc2VydmljZSA9IEhUVFBDYWNoZS5zZXJ2aWNlKCdncm91cCcpLm9uZSgnbGV2ZWxzJyk7XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICB9XG59KSgpOyIsIi8qKlxuICogbm90b3MuZmlsdGVyXG4gKiBGQUNUT1JZOiBUYWdcbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3MuZmlsdGVyJylcbiAgICAgICAgLmZhY3RvcnkoJ1RhZycsIFRhZyk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBUYWcoSFRUUENhY2hlKSB7XG4gICAgICAgIHZhciBzZXJ2aWNlID0gSFRUUENhY2hlLnNlcnZpY2UoJ3RhZ3MnKTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcbiAgICB9XG59KSgpOyIsIi8qKlxuICogbm90b3MubGF5b3V0XG4gKiBDT05UUk9MTEVSOiBTaGVsbENvbnRyb2xsZXJcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmxheW91dCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdTaGVsbENvbnRyb2xsZXInLCBTaGVsbENvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gU2hlbGxDb250cm9sbGVyKCkge1xuICAgICAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuXG4gICAgICAgIGFjdGl2YXRlKCk7XG4gICAgICAgIC8vLy8vLy8vLy8vLy9cblxuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuXG4gICAgICAgIH1cblxuXG4gICAgfVxuXG5cbn0pKCk7IiwiLyoqXG4gKiBub3Rvcy53ZWJzaXRlc1xuICogRklMVEVSOiBTZWFyY2hXZWJzaXRlXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy53ZWJzaXRlcycpXG4gICAgICAgIC5maWx0ZXIoJ1NlYXJjaFdlYnNpdGUnLCBTZWFyY2hXZWJzaXRlKTtcblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgZnVuY3Rpb24gU2VhcmNoV2Vic2l0ZShfKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAod2Vic2l0ZXMsIGZpbHRlcikge1xuICAgICAgICAgICAgdmFyIGZpbHRlcmVkID0gW107XG4gICAgICAgICAgICB2YXIgdGVybXMgPSBmaWx0ZXIudGVybXMgPT09ICcnID8gbnVsbCA6IGZpbHRlci50ZXJtcy5zcGxpdCgnICcpO1xuICAgICAgICAgICAgdmFyIHRhZ3MgPSBmaWx0ZXIudGFncztcbiAgICAgICAgICAgIHZhciBsZXZlbHMgPSBmaWx0ZXIubGV2ZWxzO1xuXG4gICAgICAgICAgICB2YXIgdG1wID0gW107XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3ZWJzaXRlcywgZnVuY3Rpb24gKHdlYnNpdGUpIHtcbiAgICAgICAgICAgICAgICAvL0ZJUlNUIGZpbHRlciBieSBUYWdzIEFORCBMZXZlbHMgKEFORCBvcGVyYXRvcilcbiAgICAgICAgICAgICAgICAvL2NoZWNrIHRhZ3NcbiAgICAgICAgICAgICAgICBpZiAodGFncy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHdlYnNpdGUudGFncywgZnVuY3Rpb24gKHRhZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy90YWcgc2VsZWN0ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfLnNvbWUodGFncywgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQuaWQgPT09IHRhZy5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFVuaXF1ZSh3ZWJzaXRlLCB0bXApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgd2Vic2l0ZXMgPSB0YWdzLmxlbmd0aCA/IHRtcCA6IHdlYnNpdGVzO1xuICAgICAgICAgICAgaWYgKGxldmVscy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0bXAgPSBbXTtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2god2Vic2l0ZXMsIGZ1bmN0aW9uICh3ZWJzaXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgb2JqZWN0aXZlIGxldmVsc1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChfLmFueShsZXZlbHMsIGZ1bmN0aW9uIChsZXZlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfLmFueSh3ZWJzaXRlLm9iamVjdGl2ZXMsIGZ1bmN0aW9uIChvYmplY3RpdmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uc29tZShvYmplY3RpdmUubGV2ZWxzLCBmdW5jdGlvbiAobCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGwubGV2ZWwgPiAwICYmIGwuZ3JvdXAuaWQgPT09IGxldmVsLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZFVuaXF1ZSh3ZWJzaXRlLCB0bXApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vV2l0aGluIHRoZXNlIHJlc3VsdHMgZmlsdGVyIGJ5IHRlcm1zIChPUiBvcGVyYXRvcilcbiAgICAgICAgICAgIHdlYnNpdGVzID0gdGFncy5sZW5ndGggfHwgbGV2ZWxzLmxlbmd0aCA/IHRtcCA6IHdlYnNpdGVzO1xuICAgICAgICAgICAgaWYgKHRlcm1zKSB7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHdlYnNpdGVzLCBmdW5jdGlvbiAod2Vic2l0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9jaGVjayBuYW1lIGFuZCBkZXNjcmlwdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF8uc29tZSh0ZXJtcywgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVDb250YWluc1Rlcm0od2Vic2l0ZS5uYW1lLCB0KSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb25Db250YWluc1Rlcm0od2Vic2l0ZS5kZXNjcmlwdGlvbiwgdCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdGl2ZXNDb250YWluc1Rlcm0od2Vic2l0ZS5vYmplY3RpdmVzLCB0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZFVuaXF1ZSh3ZWJzaXRlLCBmaWx0ZXJlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJlZCA9IHRtcDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGZpbHRlcmVkO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBhZGRVbmlxdWUod2Vic2l0ZSwgbGlzdCkge1xuICAgICAgICAgICAgICAgIGlmIChsaXN0LmluZGV4T2Yod2Vic2l0ZSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaCh3ZWJzaXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIG5hbWVDb250YWluc1Rlcm0obmFtZSwgdGVybSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuYW1lICYmIF8uY29udGFpbnMobmFtZS50b0xvd2VyQ2FzZSgpLCB0ZXJtLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBkZXNjcmlwdGlvbkNvbnRhaW5zVGVybShkZXNjcmlwdGlvbiwgdGVybSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkZXNjcmlwdGlvbiAmJiBfLmNvbnRhaW5zKGRlc2NyaXB0aW9uLnRvTG93ZXJDYXNlKCksIHRlcm0udG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIG9iamVjdGl2ZXNDb250YWluc1Rlcm0ob2JqZWN0aXZlcywgdGVybSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBfLnNvbWUob2JqZWN0aXZlcywgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG8gJiYgKF8uY29udGFpbnMoby5jb2RlLnRvTG93ZXJDYXNlKCksIHRlcm0udG9Mb3dlckNhc2UoKSkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uY29udGFpbnMoby5uYW1lLnRvTG93ZXJDYXNlKCksIHRlcm0udG9Mb3dlckNhc2UoKSkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cblxuICAgIH1cbn0pXG4oKTsiLCIvKipcbiAqIG5vdG9zLndlYnNpdGVzXG4gKiBGQUNUT1JZOiBXZWJzaXRlXG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLndlYnNpdGVzJylcbiAgICAgICAgLmZhY3RvcnkoJ1dlYnNpdGUnLCBXZWJzaXRlKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIFdlYnNpdGUoSFRUUENhY2hlKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBmdWxsOiBmdWxsLFxuICAgICAgICAgICAgZ2V0TGlzdDogZ2V0TGlzdFxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0TGlzdCgpIHtcbiAgICAgICAgICAgIHJldHVybiBIVFRQQ2FjaGUuc2VydmljZSgnd2Vic2l0ZXMnKS5nZXRMaXN0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBmdWxsKCkge1xuICAgICAgICAgICAgcmV0dXJuIEhUVFBDYWNoZS5zZXJ2aWNlKCd3ZWJzaXRlcycpLm9uZSgnZnVsbCcpLmdldExpc3QoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiLy8gSW5jbHVkZSBpbiBpbmRleC5odG1sIHNvIHRoYXQgYXBwIGxldmVsIGV4Y2VwdGlvbnMgYXJlIGhhbmRsZWQuXG4vLyBFeGNsdWRlIGZyb20gdGVzdFJ1bm5lci5odG1sIHdoaWNoIHNob3VsZCBydW4gZXhhY3RseSB3aGF0IGl0IHdhbnRzIHRvIHJ1blxuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicpXG4gICAgICAgIC5wcm92aWRlcignZXhjZXB0aW9uSGFuZGxlcicsIGV4Y2VwdGlvbkhhbmRsZXJQcm92aWRlcilcbiAgICAgICAgLmNvbmZpZyhjb25maWcpO1xuXG4gICAgLyoqXG4gICAgICogTXVzdCBjb25maWd1cmUgdGhlIGV4Y2VwdGlvbiBoYW5kbGluZ1xuICAgICAqIEByZXR1cm4ge1t0eXBlXX1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBleGNlcHRpb25IYW5kbGVyUHJvdmlkZXIoKSB7XG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgICAgICAgIGFwcEVycm9yUHJlZml4OiB1bmRlZmluZWRcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmNvbmZpZ3VyZSA9IGZ1bmN0aW9uIChhcHBFcnJvclByZWZpeCkge1xuICAgICAgICAgICAgdGhpcy5jb25maWcuYXBwRXJyb3JQcmVmaXggPSBhcHBFcnJvclByZWZpeDtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLiRnZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB7Y29uZmlnOiB0aGlzLmNvbmZpZ307XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29uZmlndXJlIGJ5IHNldHRpbmcgYW4gb3B0aW9uYWwgc3RyaW5nIHZhbHVlIGZvciBhcHBFcnJvclByZWZpeC5cbiAgICAgKiBBY2Nlc3NpYmxlIHZpYSBjb25maWcuYXBwRXJyb3JQcmVmaXggKHZpYSBjb25maWcgdmFsdWUpLlxuICAgICAqIEBwYXJhbSAge1t0eXBlXX0gJHByb3ZpZGVcbiAgICAgKiBAcmV0dXJuIHtbdHlwZV19XG4gICAgICogQG5nSW5qZWN0XG4gICAgICovXG4gICAgZnVuY3Rpb24gY29uZmlnKCRwcm92aWRlKSB7XG4gICAgICAgICRwcm92aWRlLmRlY29yYXRvcignJGV4Y2VwdGlvbkhhbmRsZXInLCBleHRlbmRFeGNlcHRpb25IYW5kbGVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeHRlbmQgdGhlICRleGNlcHRpb25IYW5kbGVyIHNlcnZpY2UgdG8gYWxzbyBkaXNwbGF5IGEgdG9hc3QuXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSAkZGVsZWdhdGVcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGV4Y2VwdGlvbkhhbmRsZXJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGxvZ2dlclxuICAgICAqIEByZXR1cm4ge0Z1bmN0aW9ufSB0aGUgZGVjb3JhdGVkICRleGNlcHRpb25IYW5kbGVyIHNlcnZpY2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBleHRlbmRFeGNlcHRpb25IYW5kbGVyKCRkZWxlZ2F0ZSwgZXhjZXB0aW9uSGFuZGxlciwgbG9nZ2VyKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihleGNlcHRpb24sIGNhdXNlKSB7XG4gICAgICAgICAgICB2YXIgYXBwRXJyb3JQcmVmaXggPSBleGNlcHRpb25IYW5kbGVyLmNvbmZpZy5hcHBFcnJvclByZWZpeCB8fCAnJztcbiAgICAgICAgICAgIHZhciBlcnJvckRhdGEgPSB7ZXhjZXB0aW9uOiBleGNlcHRpb24sIGNhdXNlOiBjYXVzZX07XG4gICAgICAgICAgICBleGNlcHRpb24ubWVzc2FnZSA9IGFwcEVycm9yUHJlZml4ICsgZXhjZXB0aW9uLm1lc3NhZ2U7XG4gICAgICAgICAgICAkZGVsZWdhdGUoZXhjZXB0aW9uLCBjYXVzZSk7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENvdWxkIGFkZCB0aGUgZXJyb3IgdG8gYSBzZXJ2aWNlJ3MgY29sbGVjdGlvbixcbiAgICAgICAgICAgICAqIGFkZCBlcnJvcnMgdG8gJHJvb3RTY29wZSwgbG9nIGVycm9ycyB0byByZW1vdGUgd2ViIHNlcnZlcixcbiAgICAgICAgICAgICAqIG9yIGxvZyBsb2NhbGx5LiBPciB0aHJvdyBoYXJkLiBJdCBpcyBlbnRpcmVseSB1cCB0byB5b3UuXG4gICAgICAgICAgICAgKiB0aHJvdyBleGNlcHRpb247XG4gICAgICAgICAgICAgKlxuICAgICAgICAgICAgICogQGV4YW1wbGVcbiAgICAgICAgICAgICAqICAgICB0aHJvdyB7IG1lc3NhZ2U6ICdlcnJvciBtZXNzYWdlIHdlIGFkZGVkJyB9O1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXhjZXB0aW9uLm1lc3NhZ2UsIGVycm9yRGF0YSk7XG4gICAgICAgIH07XG4gICAgfVxufSkoKTsiLCIvKipcbiAqIGJsb2Nrcy5leGNlcHRpb25cbiAqIEZBQ1RPUlk6IGV4Y2VwdGlvblxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdibG9ja3MuZXhjZXB0aW9uJylcbiAgICAgICAgLmZhY3RvcnkoJ2V4Y2VwdGlvbicsIGV4Y2VwdGlvbik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBleGNlcHRpb24obG9nZ2VyKSB7XG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgY2F0Y2hlcjogY2F0Y2hlclxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gc2VydmljZTtcblxuICAgICAgICBmdW5jdGlvbiBjYXRjaGVyKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihyZWFzb24pIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IobWVzc2FnZSwgcmVhc29uKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIi8qKlxuICogYmxvY2tzLmxvZ2dlclxuICogRkFDVE9SWTogbG9nZ2VyXG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2Jsb2Nrcy5sb2dnZXInKVxuICAgICAgICAuZmFjdG9yeSgnbG9nZ2VyJywgbG9nZ2VyKTtcblxuICAgIGxvZ2dlci4kaW5qZWN0ID0gWyckbG9nJywgJ3RvYXN0ciddO1xuXG4gICAgZnVuY3Rpb24gbG9nZ2VyKCRsb2csIHRvYXN0cikge1xuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIHNob3dUb2FzdHM6IHRydWUsXG5cbiAgICAgICAgICAgIGVycm9yOiBlcnJvcixcbiAgICAgICAgICAgIGluZm86IGluZm8sXG4gICAgICAgICAgICBzdWNjZXNzOiBzdWNjZXNzLFxuICAgICAgICAgICAgd2FybmluZzogd2FybmluZyxcblxuICAgICAgICAgICAgcmVtb3ZlZDogcmVtb3ZlZCxcbiAgICAgICAgICAgIHNhdmVkOiBzYXZlZCxcblxuICAgICAgICAgICAgLy8gc3RyYWlnaHQgdG8gY29uc29sZTsgYnlwYXNzIHRvYXN0clxuICAgICAgICAgICAgbG9nOiAkbG9nLmxvZ1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBlcnJvcihtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xuICAgICAgICAgICAgdG9hc3RyLmVycm9yKG1lc3NhZ2UsIHRpdGxlKTtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0ZvdXQ6ICcgKyBtZXNzYWdlLCBkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluZm8obWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcbiAgICAgICAgICAgIHRvYXN0ci5pbmZvKG1lc3NhZ2UsIHRpdGxlKTtcbiAgICAgICAgICAgICRsb2cuaW5mbygnSW5mbzogJyArIG1lc3NhZ2UsIGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3VjY2VzcyhtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xuICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MobWVzc2FnZSwgdGl0bGUpO1xuICAgICAgICAgICAgJGxvZy5pbmZvKCdTdWNjZXM6ICcgKyBtZXNzYWdlLCBkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcobWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcbiAgICAgICAgICAgIHRvYXN0ci53YXJuaW5nKG1lc3NhZ2UsIHRpdGxlKTtcbiAgICAgICAgICAgICRsb2cud2FybignTGV0IG9wOiAnICsgbWVzc2FnZSwgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZW1vdmVkKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XG4gICAgICAgICAgICB0b2FzdHIud2FybmluZyhtZXNzYWdlLCB0aXRsZSk7XG4gICAgICAgICAgICAkbG9nLndhcm4oJ1ZlcndpamRlcmQ6ICcgKyBtZXNzYWdlLCBkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNhdmVkKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XG4gICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhtZXNzYWdlLCB0aXRsZSk7XG4gICAgICAgICAgICAkbG9nLmluZm8oJ0Jld2FhcmQ6ICcgKyBtZXNzYWdlLCBkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiLyoqXG4gKiBub3Rvc3BsdXMucm91dGVyXG4gKiBGQUNUT1JZOiByb3V0ZWhlbHBlclxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdibG9ja3Mucm91dGVyJylcbiAgICAgICAgLnByb3ZpZGVyKCdyb3V0ZWhlbHBlckNvbmZpZycsIHJvdXRlaGVscGVyQ29uZmlnKVxuICAgICAgICAuZmFjdG9yeSgncm91dGVoZWxwZXInLCByb3V0ZWhlbHBlcik7XG5cbiAgICByb3V0ZWhlbHBlci4kaW5qZWN0ID0gWydyb3V0ZWhlbHBlckNvbmZpZycsICckcm9vdFNjb3BlJywgJyRzdGF0ZSddO1xuXG4gICAgZnVuY3Rpb24gcm91dGVoZWxwZXJDb25maWcoKSB7XG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xuICAgICAgICB0aGlzLmNvbmZpZyA9IHt9O1xuXG4gICAgICAgIHRoaXMuJGdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgY29uZmlnOiB0aGlzLmNvbmZpZ1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByb3V0ZWhlbHBlcihyb3V0ZWhlbHBlckNvbmZpZywgJHJvb3RTY29wZSwgJHN0YXRlKSB7XG4gICAgICAgIHZhciAkdXJsUm91dGVyUHJvdmlkZXIgPSByb3V0ZWhlbHBlckNvbmZpZy5jb25maWcuJHVybFJvdXRlclByb3ZpZGVyO1xuICAgICAgICB2YXIgJHN0YXRlUHJvdmlkZXIgPSByb3V0ZWhlbHBlckNvbmZpZy5jb25maWcuJHN0YXRlUHJvdmlkZXI7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBjb25maWd1cmVTdGF0ZXM6IGNvbmZpZ3VyZVN0YXRlcyxcbiAgICAgICAgICAgIHN0YXRlczogc3RhdGVzLFxuICAgICAgICAgICAgZ2V0OiBnZXRcbiAgICAgICAgfTtcblxuICAgICAgICBpbml0KCk7XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZVN0YXRlcyhzdGF0ZXMpIHtcbiAgICAgICAgICAgIHN0YXRlcy5mb3JFYWNoKGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5jb25maWcudGl0bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdGUuY29uZmlnLm5jeUJyZWFkY3J1bWIgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogc3RhdGUuY29uZmlnLnRpdGxlLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKHN0YXRlLnN0YXRlLCBzdGF0ZS5jb25maWcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzdGF0ZXMoKSB7XG4gICAgICAgICAgICByZXR1cm4gJHN0YXRlLmdldCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0KHBhdHRlcm4pIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBudWxsO1xuICAgICAgICAgICAgc3RhdGVzKCkuZm9yRWFjaChmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubmFtZSA9PT0gcGF0dGVybikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBzdGF0ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAgICAgdXBkYXRlRG9jVGl0bGUoKTtcbiAgICAgICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9pbmRleC9kYXNoYm9hcmQnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZURvY1RpdGxlKCkge1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChldmVudCwgY3VycmVudCwgcHJldmlvdXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gcm91dGVoZWxwZXJDb25maWcuY29uZmlnLnRpdGxlICsgKGN1cnJlbnQudGl0bGUgPyAnIHwgJyArIGN1cnJlbnQudGl0bGUgOiAnJyk7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUudGl0bGUgPSB0aXRsZTsgLy8gZGF0YSBiaW5kIHRvIDx0aXRsZT5cbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kc3RhdGUgPSBjdXJyZW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiLyoqXG4gKiBub3Rvcy53aWRnZXRzXG4gKiBESVJFQ1RJVkU6IG50RmFcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLndpZGdldHMnKVxuICAgICAgICAuZGlyZWN0aXZlKCdudEZhJywgbnRGYSk7XG5cbiAgICBudEZhLiRpbmplY3QgPSBbXTtcblxuICAgIGZ1bmN0aW9uIG50RmEoKSB7XG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgbGluazogbGlua0Z1bmNcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua0Z1bmMoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICB2YXIgaSA9IGFuZ3VsYXIuZWxlbWVudCgnPGkgY2xhc3M9XCJmYVwiIC8+Jyk7XG4gICAgICAgICAgICB2YXIgY2xhc3NlcyA9IGF0dHJzLm5hbWUuc3BsaXQoJyAnKTtcblxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGNsYXNzZXMsIGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGkuYWRkQ2xhc3MoJ2ZhLScgKyB2YWx1ZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZWxlbWVudC5yZXBsYWNlV2l0aChpKTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbiIsIi8qKlxuICogbm90b3Mud2lkZ2V0c1xuICogRElSRUNUSVZFOiBudFBhZ2luYXRpb25cbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLndpZGdldHMnKVxuICAgICAgICAuZGlyZWN0aXZlKCdudFBhZ2luYXRpb24nLCBudFBhZ2luYXRpb24pO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gbnRQYWdpbmF0aW9uKCRjb21waWxlKSB7XG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgdG90YWxJdGVtczogJz0nLFxuICAgICAgICAgICAgICAgIGl0ZW1zUGVyUGFnZTogJz0nLFxuICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlOiAnPSdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsaW5rOiBsaW5rRnVuYyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFBhZ2luYXRlQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUgLy8gYmVjYXVzZSB0aGUgc2NvcGUgaXMgaXNvbGF0ZWRcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbGlua0Z1bmMoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgICAgICB2YXIgcGFnaW5hdGlvbiA9IGFuZ3VsYXIuZWxlbWVudCgnPHBhZ2luYXRpb24gLz4nKVxuICAgICAgICAgICAgcGFnaW5hdGlvbi5hdHRyKCdkYXRhLWJvdW5kYXJ5LWxpbmtzJywgdHJ1ZSk7XG4gICAgICAgICAgICBwYWdpbmF0aW9uLmF0dHIoJ2RhdGEtdG90YWwtaXRlbXMnLCAndG90YWxJdGVtcycpO1xuICAgICAgICAgICAgcGFnaW5hdGlvbi5hdHRyKCdkYXRhLWl0ZW1zLXBlci1wYWdlJywgJ2l0ZW1zUGVyUGFnZScpO1xuICAgICAgICAgICAgcGFnaW5hdGlvbi5hdHRyKCdkYXRhLW1heC1zaXplJywgNSk7XG4gICAgICAgICAgICBwYWdpbmF0aW9uLmF0dHIoJ2RhdGEtbmctbW9kZWwnLCAnY3VycmVudFBhZ2UnKTtcbiAgICAgICAgICAgIHBhZ2luYXRpb24uYXR0cignZGF0YS1wcmV2aW91cy10ZXh0JywgJ+KAuScpO1xuICAgICAgICAgICAgcGFnaW5hdGlvbi5hdHRyKCdkYXRhLW5leHQtdGV4dCcsICfigLonKTtcbiAgICAgICAgICAgIHBhZ2luYXRpb24uYXR0cignZGF0YS1maXJzdC10ZXh0JywgJ8KrJyk7XG4gICAgICAgICAgICBwYWdpbmF0aW9uLmF0dHIoJ2RhdGEtbGFzdC10ZXh0JywgJ8K7Jyk7XG4gICAgICAgICAgICBwYWdpbmF0aW9uLmF0dHIoJ2RhdGEtbmctaGlkZScsICdoaWRlJyk7XG4gICAgICAgICAgICBpZiAoYXR0cnNbJ2NsYXNzJ10pIHtcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uLmF0dHIoJ2NsYXNzJywgYXR0cnNbJ2NsYXNzJ10pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkY29tcGlsZShwYWdpbmF0aW9uKShzY29wZSk7XG4gICAgICAgICAgICBlbGVtZW50LnJlcGxhY2VXaXRoKHBhZ2luYXRpb24pO1xuICAgICAgICB9XG5cbiAgICAgICAgLyogQG5nSW5qZWN0ICovXG4gICAgICAgIGZ1bmN0aW9uIFBhZ2luYXRlQ29udHJvbGxlcigkc2NvcGUpIHtcbiAgICAgICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgICAgIHZtLmhpZGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHZtLml0ZW1zUGVyUGFnZSA9IDEwO1xuICAgICAgICAgICAgdm0uY3VycmVudFBnZSA9IDA7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnRvdGFsSXRlbXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdm0uaGlkZSA9ICh2bS50b3RhbEl0ZW1zIDw9IHZtLml0ZW1zUGVyUGFnZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbiIsIi8qKlxuICogbm90b3Mud2lkZ2V0c1xuICogRklMVEVSOiBvZmZzZXRcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLndpZGdldHMnKVxuICAgICAgICAuZmlsdGVyKCdvZmZzZXQnLCBmaWx0ZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBmaWx0ZXIoKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBvZmZzZXQoaW5wdXQsIHN0YXJ0KSB7XG4gICAgICAgICAgICBpZiAoaW5wdXQpIHtcbiAgICAgICAgICAgICAgICBzdGFydCA9IHBhcnNlSW50KHN0YXJ0LCAxMCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0LnNsaWNlKHN0YXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfTtcbiAgICB9XG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==