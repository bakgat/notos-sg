(function () {
    'use strict';

    angular
        .module('notos', [
            //shared modules
            'notos.core',
            'notos.layout',
            'notos.data',
            'notos.widgets',

            //app modules
            'notos.dashboard',
            'notos.websites',
            'notos.filter'
        ]);
})();
angular
    .module('notos.core', [
        //Angular
        'ngAnimate', 'ngSanitize', 'ngResource',

        //3rd party
        'ui.bootstrap',
        'ncy-angular-breadcrumb',
        'restangular',

        //cross app modules
        'blocks.exception',
        'blocks.logger',
        'blocks.router'
    ]);
(function () {
    'use strict';

    angular
        .module('notos.dashboard', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.data', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.filter', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.layout', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.websites', []);
})();
(function () {
    'use strict';

    angular
        .module('notos.widgets', []);
})();
(function () {
    'use strict';

    angular
        .module('blocks.exception', ['blocks.logger']);
})();
(function () {
    'use strict';

    angular
        .module('blocks.logger', []);
})();
(function () {
    'use strict';

    angular
        .module('blocks.router', [
            'ui.router'
        ]);
})();
/**
 * notos.core
 * FACTORY: Base64
 */

(function () {
    'use strict';

    angular
        .module('notos.core')
        .factory('Base64', Base64);

    /* @ngInject */
    function Base64() {
        var keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
        var service = {
            encode: encode,
            decode: decode
        }

        return service;
        ////////////////

        function encode(input) {
            var output = "";
            var chr1, chr2, chr3 = "";
            var enc1, enc2, enc3, enc4 = "";
            var i = 0;

            do {
                chr1 = input.charCodeAt(i++);
                chr2 = input.charCodeAt(i++);
                chr3 = input.charCodeAt(i++);

                enc1 = chr1 >> 2;
                enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);
                enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);
                enc4 = chr3 & 63;

                if (isNaN(chr2)) {
                    enc3 = enc4 = 64;
                } else if (isNaN(chr3)) {
                    enc4 = 64;
                }

                output = output +
                    keyStr.charAt(enc1) +
                    keyStr.charAt(enc2) +
                    keyStr.charAt(enc3) +
                    keyStr.charAt(enc4);
                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";
            } while (i < input.length);

            return output;
        }

        function decode(input) {
            var output = "";
            var chr1, chr2, chr3 = "";
            var enc1, enc2, enc3, enc4 = "";
            var i = 0;

            // remove all characters that are not A-Z, a-z, 0-9, +, /, or =
            var base64test = /[^A-Za-z0-9\+\/\=]/g;
            if (base64test.exec(input)) {
                window.alert("There were invalid base64 characters in the input text.\n" +
                    "Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\n" +
                    "Expect errors in decoding.");
            }
            input = input.replace(/[^A-Za-z0-9\+\/\=]/g, "");

            do {
                enc1 = keyStr.indexOf(input.charAt(i++));
                enc2 = keyStr.indexOf(input.charAt(i++));
                enc3 = keyStr.indexOf(input.charAt(i++));
                enc4 = keyStr.indexOf(input.charAt(i++));

                chr1 = (enc1 << 2) | (enc2 >> 4);
                chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
                chr3 = ((enc3 & 3) << 6) | enc4;

                output = output + String.fromCharCode(chr1);

                if (enc3 != 64) {
                    output = output + String.fromCharCode(chr2);
                }
                if (enc4 != 64) {
                    output = output + String.fromCharCode(chr3);
                }

                chr1 = chr2 = chr3 = "";
                enc1 = enc2 = enc3 = enc4 = "";

            } while (i < input.length);

            return output;
        }
    };
})();
/**
 * notos.core
 * FACTORY: common
 */

(function () {
    'use strict';

    angular
        .module('notos.core')
        .factory('common', common);

    function common($q, $rootScope, $timeout, logger) {

        var service = {
            // common angular dependencies
            $broadcast: $broadcast,
            $q: $q,
            $timeout: $timeout,
            // generic
            isNumber: isNumber,
            logger: logger,
            textContains: textContains
        }

        return service;
        ////////////////////////

        function $broadcast() {
            return $rootScope.$broadcast.apply($rootScope, arguments);
        }


        function isNumber(val) {
            // negative or positive
            return (/^[-]?\d+$/).test(val);
        }

        function textContains(text, searchText) {
            return text && -1 !== text.toLowerCase().indexOf(searchText.toLowerCase());
        }
    }
    common.$inject = ["$q", "$rootScope", "$timeout", "logger"];
})();
(function () {
    'use strict';

    var core = angular.module('notos.core');

    core.config(toastrConfig);

    /* @ngInject */
    function toastrConfig(toastr) {
        toastr.options.timeOut = 4000;
        toastr.options.closeButton = true;
        toastr.options.progressBar = true;
        toastr.options.positionClass = 'toast-bottom-right';
    }
    toastrConfig.$inject = ["toastr"];

    var config = {
        appErrorPrefix: '[Fout] ',
        appTitle: 'noTos',
        version: '1.0.0'
    };

    core.value('config', config);

    core.config(configure);

    core.run(afterViewContentLoaded);

    core.run(set404);


    /* @ngInject */
    function configure($urlRouterProvider, $stateProvider,
                       routehelperConfigProvider, $breadcrumbProvider,
                       RestangularProvider) {

        configureRouting();
        configureBreadcrumb();

        configureRestangular();

        function configureRouting() {
            routehelperConfigProvider.config.$urlRouterProvider = $urlRouterProvider;
            routehelperConfigProvider.config.$stateProvider = $stateProvider;

            routehelperConfigProvider.config.title = config.appTitle;
        }

        function configureBreadcrumb() {
            $breadcrumbProvider.setOptions({
                prefixStateName: 'index',
                template: 'bootstrap3',
                includeAbstract: true
            });
        }

        function configureRestangular() {
            var baseUrl = '/api';

            RestangularProvider.setBaseUrl(baseUrl);
        }


    }
    configure.$inject = ["$urlRouterProvider", "$stateProvider", "routehelperConfigProvider", "$breadcrumbProvider", "RestangularProvider"];

    /* @ngInject */
    function afterViewContentLoaded($rootScope) {
        $rootScope.$on('$viewContentLoaded',function(){
            angular.element('html, body').animate({ scrollTop: 0 }, 200);
        })
    }
    afterViewContentLoaded.$inject = ["$rootScope"];

    /* @ngInject */
    function set404($rootScope) {
        $rootScope.$on('$stateChangeError', function(event) {
            event.preventDefault();
            $state.go('error.404');
        });
    }
    set404.$inject = ["$rootScope"];

})();
/* global toastr:false, moment:false */
(function() {
    'use strict';

    angular
        .module('notos.core')
        .constant('toastr', toastr)
        .constant('moment', moment)
        .constant('_', window._);
})();
/**
 * ROUTES: notos.core
 */
(function () {
    'use strict';

    angular
        .module('notos.core')
        .run(configRoutes);

    /* @ngInject */
    function configRoutes(routehelper) {
        routehelper.configureStates(getStates());
    }
    configRoutes.$inject = ["routehelper"];;

    function getStates() {
        return [
            {
                state: 'error',
                config: {
                    abstract: true,
                    url: '/error',
                    views: {
                        'main@': {
                            templateUrl: 'js/modules/layout/main.html'
                        }
                    },
                    title: 'Fout'
                }
            },
            {
                state: 'error.404',
                config: {
                    url: '/404',
                    views: {
                        'content@error': {
                            templateUrl: 'js/modules/core/errors/404.html'
                        },
                    },
                    title: 'Pagina niet gevonden'
                }
            }
        ];
    };
})();
/**
 * notos.dashboard
 * CONTROLLER: DashboardController
 */
(function () {
    'use strict';

    angular
        .module('notos.dashboard')
        .controller('DashboardController', DashboardController);

    /* @ngInject */
    function DashboardController($scope, Tag, Website, Level,
                                 SearchWebsiteFilter, $filter) {
        /*jshint validthis: true */
        var rnd = -1;
        var vm = this;

        vm.websites = [];
        vm.filtered = [];
        vm.tags = [];
        vm.levels = [];

        vm.filter = {
            levels: [],
            tags: [],
            terms: ''
        }

        vm.addLevelFilter = addLevelFilter;
        vm.removeLevelFilter = removeLevelFilter;
        vm.addTagFilter = addTagFilter;
        vm.removeTagFilter = removeTagFilter;

        vm.randomSite = null;
        vm.tagLimit = 3;
        vm.levelLimit = 3;

        vm.filterFlag = false;

        vm.itemsPerPage = 10;
        vm.currentPage = 1;
        vm.totalItems = 0;


        activate();
        ///////////

        function activate() {
            getTags();
            getLevels();
            getWebsites().then(function () {
                setFilterFlag();
            });


        }

        function getTags() {
            return Tag.getList().then(tagsCompleted);

            function tagsCompleted(response) {
                return vm.tags = response;
            }
        }

        function getLevels() {
            return Level.getList().then(levelCompleted);

            function levelCompleted(response) {
                return vm.levels = response;
            }
        }

        function getWebsites() {
            return Website.full().then(websitesCompleted);

            function websitesCompleted(response) {
                return vm.websites = response;
            }
        }

        function addLevelFilter(level) {
            vm.filter.levels.push(level);
            var index = vm.levels.indexOf(level);
            vm.levels.splice(index, 1);
        }

        function removeLevelFilter(level) {
            vm.levels.push(level);
            //vm.levels = $filter('orderBy')(vm.levels, 'id');
            var index = vm.filter.levels.indexOf(level);
            vm.filter.levels.splice(index, 1);
        }

        function addTagFilter(tag) {
            vm.filter.tags.push(tag);
            var index = vm.tags.indexOf(tag);
            vm.tags.splice(index, 1);
        }

        function removeTagFilter(tag) {
            vm.tags.push(tag);
            //vm.tags = $filter('orderBy')(vm.tags, 'name');
            var index = vm.filter.tags.indexOf(tag);
            vm.filter.tags.splice(index, 1);
        }

        $scope.$watch('vm.filter', function (tags) {
            if (vm.websites.length) {
                vm.filtered = SearchWebsiteFilter(vm.websites, vm.filter);
            }
            setFilterFlag();
        }, true);

        $scope.$watchGroup(['vm.currentPage', 'vm.totalItems', 'vm.itemsPerPage'], function () {
            setPaginationText();
        });


        function setFilterFlag() {
            vm.filterFlag = vm.filter.levels.length ||
                vm.filter.tags.length ||
                vm.filter.terms;

            if (!vm.filterFlag) {
                vm.filtered = vm.websites;
            }
            vm.totalItems = vm.filtered.length;

            setPaginationText();
        }

        function setPaginationText() {
            var total = vm.filtered.length;
            var floor = ((vm.currentPage - 1) * vm.itemsPerPage) + 1;
            var ceil = floor + (vm.itemsPerPage - 1);
            if (ceil > total) {
                ceil = total;
            }

            if (total > 0 && total > vm.itemsPerPage) {
                vm.paginationText = 'Toont ' + floor +
                    (total > 1 ? ' - ' + ' ' + ceil : '') +
                    ' (van ' + total + ' websites)';
            } else {
                vm.paginationText = '';
            }
        }

        $scope.$watch('vm.websites', function () {
            if (vm.websites.length) {
                setRandomSite();
            }
        });
        function setRandomSite() {
            while (!vm.randomSite || !vm.randomSite.image) {
                rnd = Math.floor((Math.random() * vm.websites.length));
                vm.randomSite = vm.websites[rnd];
            }
            return vm.randomSite;
        }
    }
    DashboardController.$inject = ["$scope", "Tag", "Website", "Level", "SearchWebsiteFilter", "$filter"];
})();
/**
 * ROUTES: notos.dashboard
 */
(function () {
    'use strict';

    angular
        .module('notos.dashboard')
        .run(configRoutes);

    /* @ngInject */
    function configRoutes(routehelper) {
        routehelper.configureStates(getStates());
    }
    configRoutes.$inject = ["routehelper"];;

    function getStates() {
        return [
            {
                state: 'index',
                config: {
                    abstract: true,
                    url: '/index',
                    views: {
                        'main@': {
                            templateUrl: 'js/modules/layout/main.html'
                        }
                    },
                    title: 'start'
                }
            },
            {
                state: 'index.dashboard',
                config: {
                    url: '/dashboard',
                    views: {
                        'content@index': {
                            templateUrl: 'js/modules/dashboard/dashboard.html',
                            controller: 'DashboardController',
                            controllerAs: 'vm'
                        }
                    },
                    title: 'Dashboard'
                }
            }
        ];
    };
})();
/**
 * notos.data
 * FILTER: Highlight
 */
(function () {
    'use strict';

    angular
        .module('notos.data')
        .filter('Highlight', Highlight);

    /**
     *
     */
    function Highlight($sce) {
        return function (str, termsToHighlight) {
            if (termsToHighlight === '') {
                return $sce.trustAsHtml(str);
            }
            // Sort terms by length
            termsToHighlight = termsToHighlight.split(" ");
            termsToHighlight.sort(function (a, b) {
                return b.length - a.length;
            });

            // Regex to simultaneously replace terms
            var regex = new RegExp('(?!<[^>]*?>)' + termsToHighlight.join('|') + '(?![^<]*?</[^>]*?>)', 'gi');
            return $sce.trustAsHtml(str.replace(regex, '<span class="match">$&</span>'));
        };
    }
    Highlight.$inject = ["$sce"];

})();
/**
 * notos.data
 * FACTORY: HTTPCache
 */

(function () {
    'use strict';

    angular
        .module('notos.data')
        .factory('HTTPCache', HTTPCache);

    /* @ngInject */
    function HTTPCache(Restangular, $cacheFactory) {
        var cache;
        cache = $cacheFactory('http');

        return Restangular.withConfig(function (RestangularConfigurer) {
            RestangularConfigurer.setDefaultHttpFields({cache: cache});
            RestangularConfigurer.setResponseInterceptor(function (response, operation) {
                if (operation === 'put' || operation === 'post' || operation === 'delete') {
                    cache.removeAll();
                }
                return response;
            });

            // Custom Global Method(s) for Restangularized Elements.
            RestangularConfigurer.setOnElemRestangularized(function(elem, isCollection) {
                elem.clearCache = function() {
                    cache.removeAll();
                }
                return elem;
            });
        });
    }
    HTTPCache.$inject = ["Restangular", "$cacheFactory"];
})();
/**
 * notos.filter
 * FACTORY: Level
 */

(function () {
    'use strict';

    angular
        .module('notos.filter')
        .factory('Level', Level);

    /* @ngInject */
    function Level(HTTPCache) {
        var service = HTTPCache.service('group').one('levels');

        return service;

    }
    Level.$inject = ["HTTPCache"];
})();
/**
 * notos.filter
 * FACTORY: Tag
 */

(function () {
    'use strict';

    angular
        .module('notos.filter')
        .factory('Tag', Tag);

    /* @ngInject */
    function Tag(HTTPCache) {
        var service = HTTPCache.service('tags');

        return service;
    }
    Tag.$inject = ["HTTPCache"];
})();
/**
 * notos.layout
 * CONTROLLER: ShellController
 */
(function () {
    'use strict';

    angular
        .module('notos.layout')
        .controller('ShellController', ShellController);

    /* @ngInject */
    function ShellController() {
        /*jshint validthis: true */
        var vm = this;


        activate();
        /////////////


        function activate() {

        }


    }


})();
/**
 * notos.websites
 * FILTER: SearchWebsite
 */
(function () {
    'use strict';

    angular
        .module('notos.websites')
        .filter('SearchWebsite', SearchWebsite);

    /**
     *
     */
    function SearchWebsite(_) {
        return function (websites, filter) {
            var filtered = [];
            var terms = filter.terms === '' ? null : filter.terms.split(' ');
            var tags = filter.tags;
            var levels = filter.levels;

            var tmp = [];

            angular.forEach(websites, function (website) {
                //FIRST filter by Tags AND Levels (AND operator)
                //check tags
                if (tags.length) {
                    angular.forEach(website.tags, function (tag) {
                        //tag selected
                        if (_.some(tags, function (t) {
                                return t.id === tag.id;
                            })) {
                            addUnique(website, tmp);
                        }
                    });
                }
            });

            websites = tags.length ? tmp : websites;
            if (levels.length) {
                tmp = [];
                angular.forEach(websites, function (website) {
                    //check objective levels

                    if (_.any(levels, function (level) {
                            return _.any(website.objectives, function (objective) {
                                return _.some(objective.levels, function (l) {
                                    return l.level > 0 && l.group.id === level.id;
                                })
                            });
                        })) {
                        addUnique(website, tmp);
                    }
                });
            }

            //Within these results filter by terms (OR operator)
            websites = tags.length || levels.length ? tmp : websites;
            if (terms) {
                angular.forEach(websites, function (website) {
                        //check name and description
                        if (_.some(terms, function (t) {
                                return nameContainsTerm(website.name, t) ||
                                    descriptionContainsTerm(website.description, t) ||
                                    objectivesContainsTerm(website.objectives, t);
                            })) {
                            addUnique(website, filtered);
                        }
                    }
                );
            } else {
                filtered = tmp;
            }

            return filtered;

            function addUnique(website, list) {
                if (list.indexOf(website) === -1) {
                    list.push(website);
                }
            }

            function nameContainsTerm(name, term) {
                return name && _.contains(name.toLowerCase(), term.toLowerCase());
            }

            function descriptionContainsTerm(description, term) {
                return description && _.contains(description.toLowerCase(), term.toLowerCase());
            }

            function objectivesContainsTerm(objectives, term) {
                return _.some(objectives, function (o) {
                    return o && (_.contains(o.code.toLowerCase(), term.toLowerCase()) ||
                        _.contains(o.name.toLowerCase(), term.toLowerCase()));
                });
            }
        }


    }
    SearchWebsite.$inject = ["_"];
})
();
/**
 * notos.websites
 * FACTORY: Website
 */

(function () {
    'use strict';

    angular
        .module('notos.websites')
        .factory('Website', Website);

    /* @ngInject */
    function Website(HTTPCache) {

        var service = {
            full: full,
            getList: getList
        };

        return service;
        ///////////////////

        function getList() {
            return HTTPCache.service('websites').getList();
        }

        function full() {
            return HTTPCache.service('websites').one('full').getList();
        }
    }
    Website.$inject = ["HTTPCache"];
})();
// Include in index.html so that app level exceptions are handled.
// Exclude from testRunner.html which should run exactly what it wants to run
(function() {
    'use strict';

    angular
        .module('blocks.exception')
        .provider('exceptionHandler', exceptionHandlerProvider)
        .config(config);

    /**
     * Must configure the exception handling
     * @return {[type]}
     */
    function exceptionHandlerProvider() {
        /* jshint validthis:true */
        this.config = {
            appErrorPrefix: undefined
        };

        this.configure = function (appErrorPrefix) {
            this.config.appErrorPrefix = appErrorPrefix;
        };

        this.$get = function() {
            return {config: this.config};
        };
    }

    /**
     * Configure by setting an optional string value for appErrorPrefix.
     * Accessible via config.appErrorPrefix (via config value).
     * @param  {[type]} $provide
     * @return {[type]}
     * @ngInject
     */
    function config($provide) {
        $provide.decorator('$exceptionHandler', extendExceptionHandler);
    }
    config.$inject = ["$provide"];

    /**
     * Extend the $exceptionHandler service to also display a toast.
     * @param  {Object} $delegate
     * @param  {Object} exceptionHandler
     * @param  {Object} logger
     * @return {Function} the decorated $exceptionHandler service
     */
    function extendExceptionHandler($delegate, exceptionHandler, logger) {
        return function(exception, cause) {
            var appErrorPrefix = exceptionHandler.config.appErrorPrefix || '';
            var errorData = {exception: exception, cause: cause};
            exception.message = appErrorPrefix + exception.message;
            $delegate(exception, cause);
            /**
             * Could add the error to a service's collection,
             * add errors to $rootScope, log errors to remote web server,
             * or log locally. Or throw hard. It is entirely up to you.
             * throw exception;
             *
             * @example
             *     throw { message: 'error message we added' };
             */
            logger.error(exception.message, errorData);
        };
    }
    extendExceptionHandler.$inject = ["$delegate", "exceptionHandler", "logger"];
})();
/**
 * blocks.exception
 * FACTORY: exception
 */

(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .factory('exception', exception);

    /* @ngInject */
    function exception(logger) {
        var service = {
            catcher: catcher
        };
        return service;

        function catcher(message) {
            return function(reason) {
                logger.error(message, reason);
            };
        }
    }
    exception.$inject = ["logger"];
})();
/**
 * blocks.logger
 * FACTORY: logger
 */

(function () {
    'use strict';

    angular
        .module('blocks.logger')
        .factory('logger', logger);

    logger.$inject = ['$log', 'toastr'];

    function logger($log, toastr) {
        var service = {
            showToasts: true,

            error: error,
            info: info,
            success: success,
            warning: warning,

            removed: removed,
            saved: saved,

            // straight to console; bypass toastr
            log: $log.log
        };

        return service;
        /////////////////////

        function error(message, data, title) {
            toastr.error(message, title);
            $log.error('Fout: ' + message, data);
        }

        function info(message, data, title) {
            toastr.info(message, title);
            $log.info('Info: ' + message, data);
        }

        function success(message, data, title) {
            toastr.success(message, title);
            $log.info('Succes: ' + message, data);
        }

        function warning(message, data, title) {
            toastr.warning(message, title);
            $log.warn('Let op: ' + message, data);
        }

        function removed(message, data, title) {
            toastr.warning(message, title);
            $log.warn('Verwijderd: ' + message, data);
        }

        function saved(message, data, title) {
            toastr.success(message, title);
            $log.info('Bewaard: ' + message, data);
        }
    }
})();
/**
 * notosplus.router
 * FACTORY: routehelper
 */

(function () {
    'use strict';

    angular
        .module('blocks.router')
        .provider('routehelperConfig', routehelperConfig)
        .factory('routehelper', routehelper);

    routehelper.$inject = ['routehelperConfig', '$rootScope', '$state'];

    function routehelperConfig() {
        /* jshint validthis:true */
        this.config = {};

        this.$get = function () {
            return {
                config: this.config
            };
        };
    }

    function routehelper(routehelperConfig, $rootScope, $state) {
        var $urlRouterProvider = routehelperConfig.config.$urlRouterProvider;
        var $stateProvider = routehelperConfig.config.$stateProvider;

        var service = {
            configureStates: configureStates,
            states: states,
            get: get
        };

        init();

        return service;
        //////////////////

        function configureStates(states) {
            states.forEach(function (state) {
                if (state.config.title) {
                    state.config.ncyBreadcrumb = {
                        label: state.config.title.toLowerCase()
                    }
                }

                $stateProvider.state(state.state, state.config);
            });
        }

        function states() {
            return $state.get();
        }

        function get(pattern) {
            var result = null;
            states().forEach(function (state) {
                if (state.name === pattern) {
                    result = state;
                }
            });
            return result;
        }

        function init() {
            updateDocTitle();
            $urlRouterProvider.otherwise('/index/dashboard');
        }

        function updateDocTitle() {
            $rootScope.$on('$stateChangeSuccess',
                function (event, current, previous) {
                    var title = routehelperConfig.config.title + (current.title ? ' | ' + current.title : '');
                    $rootScope.title = title; // data bind to <title>
                    $rootScope.$state = current;
                }
            );
        }

    }
})();
/**
 * notos.widgets
 * DIRECTIVE: ntFa
 */
(function () {
    'use strict';

    angular
        .module('notos.widgets')
        .directive('ntFa', ntFa);

    ntFa.$inject = [];

    function ntFa() {
        var directive = {
            restrict: 'E',
            link: linkFunc
        };

        return directive;
        //////////////////////

        function linkFunc(scope, element, attrs) {
            var i = angular.element('<i class="fa" />');
            var classes = attrs.name.split(' ');

            angular.forEach(classes, function (value) {
                i.addClass('fa-' + value);
            });

            element.replaceWith(i);
        }
    }
})();


/**
 * notos.widgets
 * DIRECTIVE: ntPagination
 */
(function () {
    'use strict';

    angular
        .module('notos.widgets')
        .directive('ntPagination', ntPagination);

    /* @ngInject */
    function ntPagination($compile) {
        var directive = {
            restrict: 'EA',
            scope: {
                totalItems: '=',
                itemsPerPage: '=',
                currentPage: '='
            },
            link: linkFunc,
            controller: PaginateController,
            controllerAs: 'vm',
            bindToController: true // because the scope is isolated
        };

        PaginateController.$inject = ["$scope"];
        return directive;
        //////////////////////

        function linkFunc(scope, element, attrs) {
            var pagination = angular.element('<pagination />')
            pagination.attr('data-boundary-links', true);
            pagination.attr('data-total-items', 'totalItems');
            pagination.attr('data-items-per-page', 'itemsPerPage');
            pagination.attr('data-max-size', 5);
            pagination.attr('data-ng-model', 'currentPage');
            pagination.attr('data-previous-text', '‹');
            pagination.attr('data-next-text', '›');
            pagination.attr('data-first-text', '«');
            pagination.attr('data-last-text', '»');
            pagination.attr('data-ng-hide', 'hide');
            if (attrs['class']) {
                pagination.attr('class', attrs['class']);
            }

            $compile(pagination)(scope);
            element.replaceWith(pagination);
        }

        /* @ngInject */
        function PaginateController($scope) {
            var vm = this;

            vm.hide = false;
            vm.itemsPerPage = 10;
            vm.currentPge = 0;

            $scope.$watch('vm.totalItems', function () {
                vm.hide = (vm.totalItems <= vm.itemsPerPage);
            });
        }
    }
    ntPagination.$inject = ["$compile"];
})();


/**
 * notos.widgets
 * FILTER: offset
 */
(function () {
    'use strict';

    angular
        .module('notos.widgets')
        .filter('offset', filter);


    function filter() {
        return function offset(input, start) {
            if (input) {
                start = parseInt(start, 10);
                return input.slice(start);
            }
            return [];
        };
    }
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vdG9zLm1vZHVsZS5qcyIsImNvcmUvY29yZS5tb2R1bGUuanMiLCJkYXNoYm9hcmQvZGFzaGJvYXJkLm1vZHVsZS5qcyIsImRhdGEvZGF0YS5tb2R1bGUuanMiLCJmaWx0ZXIvZmlsdGVyLm1vZHVsZS5qcyIsImxheW91dC9sYXlvdXQubW9kdWxlLmpzIiwid2Vic2l0ZXMvd2Vic2l0ZXMubW9kdWxlLmpzIiwid2lkZ2V0cy93aWRnZXRzLm1vZHVsZS5qcyIsImJsb2Nrcy9leGNlcHRpb24vZXhjZXB0aW9uLm1vZHVsZS5qcyIsImJsb2Nrcy9sb2dnZXIvbG9nZ2VyLm1vZHVsZS5qcyIsImJsb2Nrcy9yb3V0ZXIvcm91dGVyLm1vZHVsZS5qcyIsImNvcmUvYmFzZTY0LmpzIiwiY29yZS9jb21tb24uanMiLCJjb3JlL2NvbmZpZy5qcyIsImNvcmUvY29uc3RhbnRzLmpzIiwiY29yZS9lcnJvci5yb3V0ZXMuanMiLCJkYXNoYm9hcmQvZGFzaGJvYXJkLmNvbnRyb2xsZXIuanMiLCJkYXNoYm9hcmQvZGFzaGJvYXJkLnJvdXRlcy5qcyIsImRhdGEvaGlnaGxpZ2h0LmpzIiwiZGF0YS9yZXN0YW5ndWxhci5jYWNoZS5qcyIsImZpbHRlci9sZXZlbC5qcyIsImZpbHRlci90YWcuanMiLCJsYXlvdXQvc2hlbGwuY29udHJvbGxlci5qcyIsIndlYnNpdGVzL3NlYXJjaFdlYnNpdGUuZmlsdGVyLmpzIiwid2Vic2l0ZXMvd2Vic2l0ZS5qcyIsImJsb2Nrcy9leGNlcHRpb24vZXhjZXB0aW9uLWhhbmRsZXIucHJvdmlkZXIuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5qcyIsImJsb2Nrcy9sb2dnZXIvbG9nZ2VyLmpzIiwiYmxvY2tzL3JvdXRlci9yb3V0ZWhlbHBlci5qcyIsIndpZGdldHMvaWNvbnMvbnRGYS5qcyIsIndpZGdldHMvbmF2aWdhdGlvbi9udFBhZ2luYXRpb24uanMiLCJ3aWRnZXRzL25hdmlnYXRpb24vb2Zmc2V0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxTQUFBOztZQUVBO1lBQ0E7WUFDQTtZQUNBOzs7WUFHQTtZQUNBO1lBQ0E7OztBQ2RBO0tBQ0EsT0FBQSxjQUFBOztRQUVBLGFBQUEsY0FBQTs7O1FBR0E7UUFDQTtRQUNBOzs7UUFHQTtRQUNBO1FBQ0E7O0FDYkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBLG1CQUFBOztBQ0pBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxjQUFBOztBQ0pBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxnQkFBQTs7QUNKQSxDQUFBLFlBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUEsZ0JBQUE7O0FDSkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBLGtCQUFBOztBQ0pBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxpQkFBQTs7QUNKQSxDQUFBLFlBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUEsb0JBQUEsQ0FBQTs7QUNKQSxDQUFBLFlBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUEsaUJBQUE7O0FDSkEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBLGlCQUFBO1lBQ0E7Ozs7Ozs7O0FDQUEsQ0FBQSxZQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBO1NBQ0EsUUFBQSxVQUFBOzs7SUFHQSxTQUFBLFNBQUE7UUFDQSxJQUFBLFNBQUE7UUFDQSxJQUFBLFVBQUE7WUFDQSxRQUFBO1lBQ0EsUUFBQTs7O1FBR0EsT0FBQTs7O1FBR0EsU0FBQSxPQUFBLE9BQUE7WUFDQSxJQUFBLFNBQUE7WUFDQSxJQUFBLE1BQUEsTUFBQSxPQUFBO1lBQ0EsSUFBQSxNQUFBLE1BQUEsTUFBQSxPQUFBO1lBQ0EsSUFBQSxJQUFBOztZQUVBLEdBQUE7Z0JBQ0EsT0FBQSxNQUFBLFdBQUE7Z0JBQ0EsT0FBQSxNQUFBLFdBQUE7Z0JBQ0EsT0FBQSxNQUFBLFdBQUE7O2dCQUVBLE9BQUEsUUFBQTtnQkFDQSxPQUFBLENBQUEsQ0FBQSxPQUFBLE1BQUEsTUFBQSxRQUFBO2dCQUNBLE9BQUEsQ0FBQSxDQUFBLE9BQUEsT0FBQSxNQUFBLFFBQUE7Z0JBQ0EsT0FBQSxPQUFBOztnQkFFQSxJQUFBLE1BQUEsT0FBQTtvQkFDQSxPQUFBLE9BQUE7dUJBQ0EsSUFBQSxNQUFBLE9BQUE7b0JBQ0EsT0FBQTs7O2dCQUdBLFNBQUE7b0JBQ0EsT0FBQSxPQUFBO29CQUNBLE9BQUEsT0FBQTtvQkFDQSxPQUFBLE9BQUE7b0JBQ0EsT0FBQSxPQUFBO2dCQUNBLE9BQUEsT0FBQSxPQUFBO2dCQUNBLE9BQUEsT0FBQSxPQUFBLE9BQUE7cUJBQ0EsSUFBQSxNQUFBOztZQUVBLE9BQUE7OztRQUdBLFNBQUEsT0FBQSxPQUFBO1lBQ0EsSUFBQSxTQUFBO1lBQ0EsSUFBQSxNQUFBLE1BQUEsT0FBQTtZQUNBLElBQUEsTUFBQSxNQUFBLE1BQUEsT0FBQTtZQUNBLElBQUEsSUFBQTs7O1lBR0EsSUFBQSxhQUFBO1lBQ0EsSUFBQSxXQUFBLEtBQUEsUUFBQTtnQkFDQSxPQUFBLE1BQUE7b0JBQ0E7b0JBQ0E7O1lBRUEsUUFBQSxNQUFBLFFBQUEsdUJBQUE7O1lBRUEsR0FBQTtnQkFDQSxPQUFBLE9BQUEsUUFBQSxNQUFBLE9BQUE7Z0JBQ0EsT0FBQSxPQUFBLFFBQUEsTUFBQSxPQUFBO2dCQUNBLE9BQUEsT0FBQSxRQUFBLE1BQUEsT0FBQTtnQkFDQSxPQUFBLE9BQUEsUUFBQSxNQUFBLE9BQUE7O2dCQUVBLE9BQUEsQ0FBQSxRQUFBLE1BQUEsUUFBQTtnQkFDQSxPQUFBLENBQUEsQ0FBQSxPQUFBLE9BQUEsTUFBQSxRQUFBO2dCQUNBLE9BQUEsQ0FBQSxDQUFBLE9BQUEsTUFBQSxLQUFBOztnQkFFQSxTQUFBLFNBQUEsT0FBQSxhQUFBOztnQkFFQSxJQUFBLFFBQUEsSUFBQTtvQkFDQSxTQUFBLFNBQUEsT0FBQSxhQUFBOztnQkFFQSxJQUFBLFFBQUEsSUFBQTtvQkFDQSxTQUFBLFNBQUEsT0FBQSxhQUFBOzs7Z0JBR0EsT0FB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LE1BQUE7WUFDQSxPQUFBOzs7UUFHQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSxvQkFBQTtRQUNBLEdBQUEsZUFBQTtRQUNBLEdBQUEsa0JBQUE7O1FBRUEsR0FBQSxhQUFBO1FBQ0EsR0FBQSxXQUFBO1FBQ0EsR0FBQSxhQUFBOztRQUVBLEdBQUEsYUFBQTs7UUFFQSxHQUFBLGVBQUE7UUFDQSxHQUFBLGNBQUE7UUFDQSxHQUFBLGFBQUE7OztRQUdBOzs7UUFHQSxTQUFBLFdBQUE7WUFDQTtZQUNBO1lBQ0EsY0FBQSxLQUFBLFlBQUE7Z0JBQ0E7Ozs7OztRQU1BLFNBQUEsVUFBQTtZQUNBLE9BQUEsSUFBQSxVQUFBLEtBQUE7O1lBRUEsU0FBQSxjQUFBLFVBQUE7Z0JBQ0EsT0FBQSxHQUFBLE9BQUE7Ozs7UUFJQSxTQUFBLFlBQUE7WUFDQSxPQUFBLE1BQUEsVUFBQSxLQUFBOztZQUVBLFNBQUEsZUFBQSxVQUFBO2dCQUNBLE9BQUEsR0FBQSxTQUFBOzs7O1FBSUEsU0FBQSxjQUFBO1lBQ0EsT0FBQSxRQUFBLE9BQUEsS0FBQTs7WUFFQSxTQUFBLGtCQUFBLFVBQUE7Z0JBQ0EsT0FBQSxHQUFBLFdBQUE7Ozs7UUFJQSxTQUFBLGVBQUEsT0FBQTtZQUNBLEdBQUEsT0FBQSxPQUFBLEtBQUE7WUFDQSxJQUFBLFFBQUEsR0FBQSxPQUFBLFFBQUE7WUFDQSxHQUFBLE9BQUEsT0FBQSxPQUFBOzs7UUFHQSxTQUFBLGtCQUFBLE9BQUE7WUFDQSxHQUFBLE9BQUEsS0FBQTs7WUFFQSxJQUFBLFFBQUEsR0FBQSxPQUFBLE9BQUEsUUFBQTtZQUNBLEdBQUEsT0FBQSxPQUFBLE9BQUEsT0FBQTs7O1FBR0EsU0FBQSxhQUFBLEtBQUE7WUFDQSxHQUFBLE9BQUEsS0FBQSxLQUFBO1lBQ0EsSUFBQSxRQUFBLEdBQUEsS0FBQSxRQUFBO1lBQ0EsR0FBQSxLQUFBLE9BQUEsT0FBQTs7O1FBR0EsU0FBQSxnQkFBQSxLQUFBO1lBQ0EsR0FBQSxLQUFBLEtBQUE7O1lBRUEsSUFBQSxRQUFBLEdBQUEsT0FBQSxLQUFBLFFBQUE7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OztRQUVBLElBQUEsVUFBQTtZQUNBLE1BQUE7WUFDQSxTQUFBOzs7UUFHQSxPQUFBOzs7UUFHQSxTQUFBLFVBQUE7WUFDQSxPQUFBLFVBQUEsUUFBQSxZQUFBOzs7UUFHQSxTQUFBLE9BQUE7WUFDQSxPQUFBLFVBQUEsUUFBQSxZQUFBLElBQUEsUUFBQTs7Ozs7OztBQzFCQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxTQUFBLG9CQUFBO1NBQ0EsT0FBQTs7Ozs7O0lBTUEsU0FBQSwyQkFBQTs7UUFFQSxLQUFBLFNBQUE7WUFDQSxnQkFBQTs7O1FBR0EsS0FBQSxZQUFBLFVBQUEsZ0JBQUE7WUFDQSxLQUFBLE9BQUEsaUJBQUE7OztRQUdBLEtBQUEsT0FBQSxXQUFBO1lBQ0EsT0FBQSxDQUFBLFFBQUEsS0FBQTs7Ozs7Ozs7Ozs7SUFXQSxTQUFBLE9BQUEsVUFBQTtRQUNBLFNBQUEsVUFBQSxxQkFBQTs7Ozs7Ozs7Ozs7SUFVQSxTQUFBLHVCQUFBLFdBQUEsa0JBQUEsUUFBQTtRQUNBLE9BQUEsU0FBQSxXQUFBLE9BQUE7WUFDQSxJQUFBLGlCQUFBLGlCQUFBLE9BQUEsa0JBQUE7WUFDQSxJQUFBLFlBQUEsQ0FBQSxXQUFBLFdBQUEsT0FBQTtZQUNBLFVBQUEsVUFBQSxpQkFBQSxVQUFBO1lBQ0EsVUFBQSxXQUFBOzs7Ozs7Ozs7O1lBVUEsT0FBQSxNQUFBLFVBQUEsU0FBQTs7Ozs7Ozs7OztBQ3pEQSxDQUFBLFlBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxRQUFBLGFBQUE7OztJQUdBLFNBQUEsVUFBQSxRQUFBO1FBQ0EsSUFBQSxVQUFBO1lBQ0EsU0FBQTs7UUFFQSxPQUFBOztRQUVBLFNBQUEsUUFBQSxTQUFBO1lBQ0EsT0FBQSxTQUFBLFFBQUE7Z0JBQ0EsT0FBQSxNQUFBLFNBQUE7Ozs7Ozs7Ozs7O0FDaEJBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFFBQUEsVUFBQTs7SUFFQSxPQUFBLFVBQUEsQ0FBQSxRQUFBOztJQUVBLFNBQUEsT0FB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UUFDQSxJQUFBLFlBQUE7WUFDQSxVQUFBO1lBQ0EsT0FBQTtnQkFDQSxZQUFBO2dCQUNBLGNBQUE7Z0JBQ0EsYUFBQTs7WUFFQSxNQUFBO1lBQ0EsWUFBQTtZQUNBLGNBQUE7WUFDQSxrQkFBQTs7OztRQUdBLE9BQUE7OztRQUdBLFNBQUEsU0FBQSxPQUFBLFNBQUEsT0FBQTtZQUNBLElBQUEsYUFBQSxRQUFBLFFBQUE7WUFDQSxXQUFBLEtBQUEsdUJBQUE7WUFDQSxXQUFBLEtBQUEsb0JBQUE7WUFDQSxXQUFBLEtBQUEsdUJBQUE7WUFDQSxXQUFBLEtBQUEsaUJBQUE7WUFDQSxXQUFBLEtBQUEsaUJBQUE7WUFDQSxXQUFBLEtBQUEsc0JBQUE7WUFDQSxXQUFBLEtBQUEsa0JBQUE7WUFDQSxXQUFBLEtBQUEsbUJBQUE7WUFDQSxXQUFBLEtBQUEsa0JBQUE7WUFDQSxXQUFBLEtBQUEsZ0JBQUE7WUFDQSxJQUFBLE1BQUEsVUFBQTtnQkFDQSxXQUFBLEtBQUEsU0FBQSxNQUFBOzs7WUFHQSxTQUFBLFlBQUE7WUFDQSxRQUFBLFlBQUE7Ozs7UUFJQSxTQUFBLG1CQUFBLFFBQUE7WUFDQSxJQUFBLEtBQUE7O1lBRUEsR0FBQSxPQUFBO1lBQ0EsR0FBQSxlQUFBO1lBQ0EsR0FBQSxhQUFBOztZQUVBLE9BQUEsT0FBQSxpQkFBQSxZQUFBO2dCQUNBLEdBQUEsUUFBQSxHQUFBLGNBQUEsR0FBQTs7Ozs7Ozs7Ozs7O0FDdERBLENBQUEsWUFBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLE9BQUEsVUFBQTs7O0lBR0EsU0FBQSxTQUFBO1FBQ0EsT0FBQSxTQUFBLE9BQUEsT0FBQSxPQUFBO1lBQ0EsSUFBQSxPQUFBO2dCQUNBLFFBQUEsU0FBQSxPQUFBO2dCQUNBLE9BQUEsTUFBQSxNQUFBOztZQUVBLE9BQUE7OztLQUdBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3MnLCBbXG4gICAgICAgICAgICAvL3NoYXJlZCBtb2R1bGVzXG4gICAgICAgICAgICAnbm90b3MuY29yZScsXG4gICAgICAgICAgICAnbm90b3MubGF5b3V0JyxcbiAgICAgICAgICAgICdub3Rvcy5kYXRhJyxcbiAgICAgICAgICAgICdub3Rvcy53aWRnZXRzJyxcblxuICAgICAgICAgICAgLy9hcHAgbW9kdWxlc1xuICAgICAgICAgICAgJ25vdG9zLmRhc2hib2FyZCcsXG4gICAgICAgICAgICAnbm90b3Mud2Vic2l0ZXMnLFxuICAgICAgICAgICAgJ25vdG9zLmZpbHRlcidcbiAgICAgICAgXSk7XG59KSgpOyIsImFuZ3VsYXJcbiAgICAubW9kdWxlKCdub3Rvcy5jb3JlJywgW1xuICAgICAgICAvL0FuZ3VsYXJcbiAgICAgICAgJ25nQW5pbWF0ZScsICduZ1Nhbml0aXplJywgJ25nUmVzb3VyY2UnLFxuXG4gICAgICAgIC8vM3JkIHBhcnR5XG4gICAgICAgICd1aS5ib290c3RyYXAnLFxuICAgICAgICAnbmN5LWFuZ3VsYXItYnJlYWRjcnVtYicsXG4gICAgICAgICdyZXN0YW5ndWxhcicsXG5cbiAgICAgICAgLy9jcm9zcyBhcHAgbW9kdWxlc1xuICAgICAgICAnYmxvY2tzLmV4Y2VwdGlvbicsXG4gICAgICAgICdibG9ja3MubG9nZ2VyJyxcbiAgICAgICAgJ2Jsb2Nrcy5yb3V0ZXInXG4gICAgXSk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmRhc2hib2FyZCcsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmRhdGEnLCBbXSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5maWx0ZXInLCBbXSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5sYXlvdXQnLCBbXSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy53ZWJzaXRlcycsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLndpZGdldHMnLCBbXSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdibG9ja3MuZXhjZXB0aW9uJywgWydibG9ja3MubG9nZ2VyJ10pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmxvZ2dlcicsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2Jsb2Nrcy5yb3V0ZXInLCBbXG4gICAgICAgICAgICAndWkucm91dGVyJ1xuICAgICAgICBdKTtcbn0pKCk7IiwiLyoqXG4gKiBub3Rvcy5jb3JlXG4gKiBGQUNUT1JZOiBCYXNlNjRcbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3MuY29yZScpXG4gICAgICAgIC5mYWN0b3J5KCdCYXNlNjQnLCBCYXNlNjQpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gQmFzZTY0KCkge1xuICAgICAgICB2YXIga2V5U3RyID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89JztcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBlbmNvZGU6IGVuY29kZSxcbiAgICAgICAgICAgIGRlY29kZTogZGVjb2RlXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2VydmljZTtcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGVuY29kZShpbnB1dCkge1xuICAgICAgICAgICAgdmFyIG91dHB1dCA9IFwiXCI7XG4gICAgICAgICAgICB2YXIgY2hyMSwgY2hyMiwgY2hyMyA9IFwiXCI7XG4gICAgICAgICAgICB2YXIgZW5jMSwgZW5jMiwgZW5jMywgZW5jNCA9IFwiXCI7XG4gICAgICAgICAgICB2YXIgaSA9IDA7XG5cbiAgICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgICAgICBjaHIxID0gaW5wdXQuY2hhckNvZGVBdChpKyspO1xuICAgICAgICAgICAgICAgIGNocjIgPSBpbnB1dC5jaGFyQ29kZUF0KGkrKyk7XG4gICAgICAgICAgICAgICAgY2hyMyA9IGlucHV0LmNoYXJDb2RlQXQoaSsrKTtcblxuICAgICAgICAgICAgICAgIGVuYzEgPSBjaHIxID4+IDI7XG4gICAgICAgICAgICAgICAgZW5jMiA9ICgoY2hyMSAmIDMpIDw8IDQpIHwgKGNocjIgPj4gNCk7XG4gICAgICAgICAgICAgICAgZW5jMyA9ICgoY2hyMiAmIDE1KSA8PCAyKSB8IChjaHIzID4+IDYpO1xuICAgICAgICAgICAgICAgIGVuYzQgPSBjaHIzICYgNjM7XG5cbiAgICAgICAgICAgICAgICBpZiAoaXNOYU4oY2hyMikpIHtcbiAgICAgICAgICAgICAgICAgICAgZW5jMyA9IGVuYzQgPSA2NDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTmFOKGNocjMpKSB7XG4gICAgICAgICAgICAgICAgICAgIGVuYzQgPSA2NDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBvdXRwdXQgPSBvdXRwdXQgK1xuICAgICAgICAgICAgICAgICAgICBrZXlTdHIuY2hhckF0KGVuYzEpICtcbiAgICAgICAgICAgICAgICAgICAga2V5U3RyLmNoYXJBdChlbmMyKSArXG4gICAgICAgICAgICAgICAgICAgIGtleVN0ci5jaGFyQXQoZW5jMykgK1xuICAgICAgICAgICAgICAgICAgICBrZXlTdHIuY2hhckF0KGVuYzQpO1xuICAgICAgICAgICAgICAgIGNocjEgPSBjaHIyID0gY2hyMyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZW5jMSA9IGVuYzIgPSBlbmMzID0gZW5jNCA9IFwiXCI7XG4gICAgICAgICAgICB9IHdoaWxlIChpIDwgaW5wdXQubGVuZ3RoKTtcblxuICAgICAgICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGRlY29kZShpbnB1dCkge1xuICAgICAgICAgICAgdmFyIG91dHB1dCA9IFwiXCI7XG4gICAgICAgICAgICB2YXIgY2hyMSwgY2hyMiwgY2hyMyA9IFwiXCI7XG4gICAgICAgICAgICB2YXIgZW5jMSwgZW5jMiwgZW5jMywgZW5jNCA9IFwiXCI7XG4gICAgICAgICAgICB2YXIgaSA9IDA7XG5cbiAgICAgICAgICAgIC8vIHJlbW92ZSBhbGwgY2hhcmFjdGVycyB0aGF0IGFyZSBub3QgQS1aLCBhLXosIDAtOSwgKywgLywgb3IgPVxuICAgICAgICAgICAgdmFyIGJhc2U2NHRlc3QgPSAvW15BLVphLXowLTlcXCtcXC9cXD1dL2c7XG4gICAgICAgICAgICBpZiAoYmFzZTY0dGVzdC5leGVjKGlucHV0KSkge1xuICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydChcIlRoZXJlIHdlcmUgaW52YWxpZCBiYXNlNjQgY2hhcmFjdGVycyBpbiB0aGUgaW5wdXQgdGV4dC5cXG5cIiArXG4gICAgICAgICAgICAgICAgICAgIFwiVmFsaWQgYmFzZTY0IGNoYXJhY3RlcnMgYXJlIEEtWiwgYS16LCAwLTksICcrJywgJy8nLGFuZCAnPSdcXG5cIiArXG4gICAgICAgICAgICAgICAgICAgIFwiRXhwZWN0IGVycm9ycyBpbiBkZWNvZGluZy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpbnB1dCA9IGlucHV0LnJlcGxhY2UoL1teQS1aYS16MC05XFwrXFwvXFw9XS9nLCBcIlwiKTtcblxuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICAgIGVuYzEgPSBrZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG4gICAgICAgICAgICAgICAgZW5jMiA9IGtleVN0ci5pbmRleE9mKGlucHV0LmNoYXJBdChpKyspKTtcbiAgICAgICAgICAgICAgICBlbmMzID0ga2V5U3RyLmluZGV4T2YoaW5wdXQuY2hhckF0KGkrKykpO1xuICAgICAgICAgICAgICAgIGVuYzQgPSBrZXlTdHIuaW5kZXhPZihpbnB1dC5jaGFyQXQoaSsrKSk7XG5cbiAgICAgICAgICAgICAgICBjaHIxID0gKGVuYzEgPDwgMikgfCAoZW5jMiA+PiA0KTtcbiAgICAgICAgICAgICAgICBjaHIyID0gKChlbmMyICYgMTUpIDw8IDQpIHwgKGVuYzMgPj4gMik7XG4gICAgICAgICAgICAgICAgY2hyMyA9ICgoZW5jMyAmIDMpIDw8IDYpIHwgZW5jNDtcblxuICAgICAgICAgICAgICAgIG91dHB1dCA9IG91dHB1dCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2hyMSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZW5jMyAhPSA2NCkge1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZW5jNCAhPSA2NCkge1xuICAgICAgICAgICAgICAgICAgICBvdXRwdXQgPSBvdXRwdXQgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNocjMpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNocjEgPSBjaHIyID0gY2hyMyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgZW5jMSA9IGVuYzIgPSBlbmMzID0gZW5jNCA9IFwiXCI7XG5cbiAgICAgICAgICAgIH0gd2hpbGUgKGkgPCBpbnB1dC5sZW5ndGgpO1xuXG4gICAgICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgICAgICB9XG4gICAgfTtcbn0pKCk7IiwiLyoqXG4gKiBub3Rvcy5jb3JlXG4gKiBGQUNUT1JZOiBjb21tb25cbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3MuY29yZScpXG4gICAgICAgIC5mYWN0b3J5KCdjb21tb24nLCBjb21tb24pO1xuXG4gICAgZnVuY3Rpb24gY29tbW9uKCRxLCAkcm9vdFNjb3BlLCAkdGltZW91dCwgbG9nZ2VyKSB7XG5cbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICAvLyBjb21tb24gYW5ndWxhciBkZXBlbmRlbmNpZXNcbiAgICAgICAgICAgICRicm9hZGNhc3Q6ICRicm9hZGNhc3QsXG4gICAgICAgICAgICAkcTogJHEsXG4gICAgICAgICAgICAkdGltZW91dDogJHRpbWVvdXQsXG4gICAgICAgICAgICAvLyBnZW5lcmljXG4gICAgICAgICAgICBpc051bWJlcjogaXNOdW1iZXIsXG4gICAgICAgICAgICBsb2dnZXI6IGxvZ2dlcixcbiAgICAgICAgICAgIHRleHRDb250YWluczogdGV4dENvbnRhaW5zXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2VydmljZTtcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gJGJyb2FkY2FzdCgpIHtcbiAgICAgICAgICAgIHJldHVybiAkcm9vdFNjb3BlLiRicm9hZGNhc3QuYXBwbHkoJHJvb3RTY29wZSwgYXJndW1lbnRzKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgZnVuY3Rpb24gaXNOdW1iZXIodmFsKSB7XG4gICAgICAgICAgICAvLyBuZWdhdGl2ZSBvciBwb3NpdGl2ZVxuICAgICAgICAgICAgcmV0dXJuICgvXlstXT9cXGQrJC8pLnRlc3QodmFsKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHRleHRDb250YWlucyh0ZXh0LCBzZWFyY2hUZXh0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGV4dCAmJiAtMSAhPT0gdGV4dC50b0xvd2VyQ2FzZSgpLmluZGV4T2Yoc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgY29yZSA9IGFuZ3VsYXIubW9kdWxlKCdub3Rvcy5jb3JlJyk7XG5cbiAgICBjb3JlLmNvbmZpZyh0b2FzdHJDb25maWcpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdG9hc3RyQ29uZmlnKHRvYXN0cikge1xuICAgICAgICB0b2FzdHIub3B0aW9ucy50aW1lT3V0ID0gNDAwMDtcbiAgICAgICAgdG9hc3RyLm9wdGlvbnMuY2xvc2VCdXR0b24gPSB0cnVlO1xuICAgICAgICB0b2FzdHIub3B0aW9ucy5wcm9ncmVzc0JhciA9IHRydWU7XG4gICAgICAgIHRvYXN0ci5vcHRpb25zLnBvc2l0aW9uQ2xhc3MgPSAndG9hc3QtYm90dG9tLXJpZ2h0JztcbiAgICB9XG5cbiAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICBhcHBFcnJvclByZWZpeDogJ1tGb3V0XSAnLFxuICAgICAgICBhcHBUaXRsZTogJ25vVG9zJyxcbiAgICAgICAgdmVyc2lvbjogJzEuMC4wJ1xuICAgIH07XG5cbiAgICBjb3JlLnZhbHVlKCdjb25maWcnLCBjb25maWcpO1xuXG4gICAgY29yZS5jb25maWcoY29uZmlndXJlKTtcblxuICAgIGNvcmUucnVuKGFmdGVyVmlld0NvbnRlbnRMb2FkZWQpO1xuXG4gICAgY29yZS5ydW4oc2V0NDA0KTtcblxuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gY29uZmlndXJlKCR1cmxSb3V0ZXJQcm92aWRlciwgJHN0YXRlUHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgICAgICAgIHJvdXRlaGVscGVyQ29uZmlnUHJvdmlkZXIsICRicmVhZGNydW1iUHJvdmlkZXIsXG4gICAgICAgICAgICAgICAgICAgICAgIFJlc3Rhbmd1bGFyUHJvdmlkZXIpIHtcblxuICAgICAgICBjb25maWd1cmVSb3V0aW5nKCk7XG4gICAgICAgIGNvbmZpZ3VyZUJyZWFkY3J1bWIoKTtcblxuICAgICAgICBjb25maWd1cmVSZXN0YW5ndWxhcigpO1xuXG4gICAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZVJvdXRpbmcoKSB7XG4gICAgICAgICAgICByb3V0ZWhlbHBlckNvbmZpZ1Byb3ZpZGVyLmNvbmZpZy4kdXJsUm91dGVyUHJvdmlkZXIgPSAkdXJsUm91dGVyUHJvdmlkZXI7XG4gICAgICAgICAgICByb3V0ZWhlbHBlckNvbmZpZ1Byb3ZpZGVyLmNvbmZpZy4kc3RhdGVQcm92aWRlciA9ICRzdGF0ZVByb3ZpZGVyO1xuXG4gICAgICAgICAgICByb3V0ZWhlbHBlckNvbmZpZ1Byb3ZpZGVyLmNvbmZpZy50aXRsZSA9IGNvbmZpZy5hcHBUaXRsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZUJyZWFkY3J1bWIoKSB7XG4gICAgICAgICAgICAkYnJlYWRjcnVtYlByb3ZpZGVyLnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgIHByZWZpeFN0YXRlTmFtZTogJ2luZGV4JyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ2Jvb3RzdHJhcDMnLFxuICAgICAgICAgICAgICAgIGluY2x1ZGVBYnN0cmFjdDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjb25maWd1cmVSZXN0YW5ndWxhcigpIHtcbiAgICAgICAgICAgIHZhciBiYXNlVXJsID0gJy9hcGknO1xuXG4gICAgICAgICAgICBSZXN0YW5ndWxhclByb3ZpZGVyLnNldEJhc2VVcmwoYmFzZVVybCk7XG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gYWZ0ZXJWaWV3Q29udGVudExvYWRlZCgkcm9vdFNjb3BlKSB7XG4gICAgICAgICRyb290U2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkZWQnLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHsgc2Nyb2xsVG9wOiAwIH0sIDIwMCk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gc2V0NDA0KCRyb290U2NvcGUpIHtcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2Vycm9yLjQwNCcpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbn0pKCk7IiwiLyogZ2xvYmFsIHRvYXN0cjpmYWxzZSwgbW9tZW50OmZhbHNlICovXG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5jb3JlJylcbiAgICAgICAgLmNvbnN0YW50KCd0b2FzdHInLCB0b2FzdHIpXG4gICAgICAgIC5jb25zdGFudCgnbW9tZW50JywgbW9tZW50KVxuICAgICAgICAuY29uc3RhbnQoJ18nLCB3aW5kb3cuXyk7XG59KSgpOyIsIi8qKlxuICogUk9VVEVTOiBub3Rvcy5jb3JlXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5jb3JlJylcbiAgICAgICAgLnJ1bihjb25maWdSb3V0ZXMpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gY29uZmlnUm91dGVzKHJvdXRlaGVscGVyKSB7XG4gICAgICAgIHJvdXRlaGVscGVyLmNvbmZpZ3VyZVN0YXRlcyhnZXRTdGF0ZXMoKSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGdldFN0YXRlcygpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBzdGF0ZTogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9lcnJvcicsXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbWFpbkAnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdqcy9tb2R1bGVzL2xheW91dC9tYWluLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnRm91dCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHN0YXRlOiAnZXJyb3IuNDA0JyxcbiAgICAgICAgICAgICAgICBjb25maWc6IHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnLzQwNCcsXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnY29udGVudEBlcnJvcic6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2pzL21vZHVsZXMvY29yZS9lcnJvcnMvNDA0Lmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1BhZ2luYSBuaWV0IGdldm9uZGVuJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgXTtcbiAgICB9O1xufSkoKTsiLCIvKipcbiAqIG5vdG9zLmRhc2hib2FyZFxuICogQ09OVFJPTExFUjogRGFzaGJvYXJkQ29udHJvbGxlclxuICovXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3MuZGFzaGJvYXJkJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0Rhc2hib2FyZENvbnRyb2xsZXInLCBEYXNoYm9hcmRDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIERhc2hib2FyZENvbnRyb2xsZXIoJHNjb3BlLCBUYWcsIFdlYnNpdGUsIExldmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VhcmNoV2Vic2l0ZUZpbHRlciwgJGZpbHRlcikge1xuICAgICAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHJuZCA9IC0xO1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLndlYnNpdGVzID0gW107XG4gICAgICAgIHZtLmZpbHRlcmVkID0gW107XG4gICAgICAgIHZtLnRhZ3MgPSBbXTtcbiAgICAgICAgdm0ubGV2ZWxzID0gW107XG5cbiAgICAgICAgdm0uZmlsdGVyID0ge1xuICAgICAgICAgICAgbGV2ZWxzOiBbXSxcbiAgICAgICAgICAgIHRhZ3M6IFtdLFxuICAgICAgICAgICAgdGVybXM6ICcnXG4gICAgICAgIH1cblxuICAgICAgICB2bS5hZGRMZXZlbEZpbHRlciA9IGFkZExldmVsRmlsdGVyO1xuICAgICAgICB2bS5yZW1vdmVMZXZlbEZpbHRlciA9IHJlbW92ZUxldmVsRmlsdGVyO1xuICAgICAgICB2bS5hZGRUYWdGaWx0ZXIgPSBhZGRUYWdGaWx0ZXI7XG4gICAgICAgIHZtLnJlbW92ZVRhZ0ZpbHRlciA9IHJlbW92ZVRhZ0ZpbHRlcjtcblxuICAgICAgICB2bS5yYW5kb21TaXRlID0gbnVsbDtcbiAgICAgICAgdm0udGFnTGltaXQgPSAzO1xuICAgICAgICB2bS5sZXZlbExpbWl0ID0gMztcblxuICAgICAgICB2bS5maWx0ZXJGbGFnID0gZmFsc2U7XG5cbiAgICAgICAgdm0uaXRlbXNQZXJQYWdlID0gMTA7XG4gICAgICAgIHZtLmN1cnJlbnRQYWdlID0gMTtcbiAgICAgICAgdm0udG90YWxJdGVtcyA9IDA7XG5cblxuICAgICAgICBhY3RpdmF0ZSgpO1xuICAgICAgICAvLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuICAgICAgICAgICAgZ2V0VGFncygpO1xuICAgICAgICAgICAgZ2V0TGV2ZWxzKCk7XG4gICAgICAgICAgICBnZXRXZWJzaXRlcygpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNldEZpbHRlckZsYWcoKTtcbiAgICAgICAgICAgIH0pO1xuXG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFRhZ3MoKSB7XG4gICAgICAgICAgICByZXR1cm4gVGFnLmdldExpc3QoKS50aGVuKHRhZ3NDb21wbGV0ZWQpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiB0YWdzQ29tcGxldGVkKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZtLnRhZ3MgPSByZXNwb25zZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldExldmVscygpIHtcbiAgICAgICAgICAgIHJldHVybiBMZXZlbC5nZXRMaXN0KCkudGhlbihsZXZlbENvbXBsZXRlZCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGxldmVsQ29tcGxldGVkKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZtLmxldmVscyA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0V2Vic2l0ZXMoKSB7XG4gICAgICAgICAgICByZXR1cm4gV2Vic2l0ZS5mdWxsKCkudGhlbih3ZWJzaXRlc0NvbXBsZXRlZCk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHdlYnNpdGVzQ29tcGxldGVkKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZtLndlYnNpdGVzID0gcmVzcG9uc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBhZGRMZXZlbEZpbHRlcihsZXZlbCkge1xuICAgICAgICAgICAgdm0uZmlsdGVyLmxldmVscy5wdXNoKGxldmVsKTtcbiAgICAgICAgICAgIHZhciBpbmRleCA9IHZtLmxldmVscy5pbmRleE9mKGxldmVsKTtcbiAgICAgICAgICAgIHZtLmxldmVscy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlTGV2ZWxGaWx0ZXIobGV2ZWwpIHtcbiAgICAgICAgICAgIHZtLmxldmVscy5wdXNoKGxldmVsKTtcbiAgICAgICAgICAgIC8vdm0ubGV2ZWxzID0gJGZpbHRlcignb3JkZXJCeScpKHZtLmxldmVscywgJ2lkJyk7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSB2bS5maWx0ZXIubGV2ZWxzLmluZGV4T2YobGV2ZWwpO1xuICAgICAgICAgICAgdm0uZmlsdGVyLmxldmVscy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gYWRkVGFnRmlsdGVyKHRhZykge1xuICAgICAgICAgICAgdm0uZmlsdGVyLnRhZ3MucHVzaCh0YWcpO1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gdm0udGFncy5pbmRleE9mKHRhZyk7XG4gICAgICAgICAgICB2bS50YWdzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiByZW1vdmVUYWdGaWx0ZXIodGFnKSB7XG4gICAgICAgICAgICB2bS50YWdzLnB1c2godGFnKTtcbiAgICAgICAgICAgIC8vdm0udGFncyA9ICRmaWx0ZXIoJ29yZGVyQnknKSh2bS50YWdzLCAnbmFtZScpO1xuICAgICAgICAgICAgdmFyIGluZGV4ID0gdm0uZmlsdGVyLnRhZ3MuaW5kZXhPZih0YWcpO1xuICAgICAgICAgICAgdm0uZmlsdGVyLnRhZ3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLmZpbHRlcicsIGZ1bmN0aW9uICh0YWdzKSB7XG4gICAgICAgICAgICBpZiAodm0ud2Vic2l0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdm0uZmlsdGVyZWQgPSBTZWFyY2hXZWJzaXRlRmlsdGVyKHZtLndlYnNpdGVzLCB2bS5maWx0ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0RmlsdGVyRmxhZygpO1xuICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoR3JvdXAoWyd2bS5jdXJyZW50UGFnZScsICd2bS50b3RhbEl0ZW1zJywgJ3ZtLml0ZW1zUGVyUGFnZSddLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBzZXRQYWdpbmF0aW9uVGV4dCgpO1xuICAgICAgICB9KTtcblxuXG4gICAgICAgIGZ1bmN0aW9uIHNldEZpbHRlckZsYWcoKSB7XG4gICAgICAgICAgICB2bS5maWx0ZXJGbGFnID0gdm0uZmlsdGVyLmxldmVscy5sZW5ndGggfHxcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXIudGFncy5sZW5ndGggfHxcbiAgICAgICAgICAgICAgICB2bS5maWx0ZXIudGVybXM7XG5cbiAgICAgICAgICAgIGlmICghdm0uZmlsdGVyRmxhZykge1xuICAgICAgICAgICAgICAgIHZtLmZpbHRlcmVkID0gdm0ud2Vic2l0ZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2bS50b3RhbEl0ZW1zID0gdm0uZmlsdGVyZWQubGVuZ3RoO1xuXG4gICAgICAgICAgICBzZXRQYWdpbmF0aW9uVGV4dCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2V0UGFnaW5hdGlvblRleHQoKSB7XG4gICAgICAgICAgICB2YXIgdG90YWwgPSB2bS5maWx0ZXJlZC5sZW5ndGg7XG4gICAgICAgICAgICB2YXIgZmxvb3IgPSAoKHZtLmN1cnJlbnRQYWdlIC0gMSkgKiB2bS5pdGVtc1BlclBhZ2UpICsgMTtcbiAgICAgICAgICAgIHZhciBjZWlsID0gZmxvb3IgKyAodm0uaXRlbXNQZXJQYWdlIC0gMSk7XG4gICAgICAgICAgICBpZiAoY2VpbCA+IHRvdGFsKSB7XG4gICAgICAgICAgICAgICAgY2VpbCA9IHRvdGFsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodG90YWwgPiAwICYmIHRvdGFsID4gdm0uaXRlbXNQZXJQYWdlKSB7XG4gICAgICAgICAgICAgICAgdm0ucGFnaW5hdGlvblRleHQgPSAnVG9vbnQgJyArIGZsb29yICtcbiAgICAgICAgICAgICAgICAgICAgKHRvdGFsID4gMSA/ICcgLSAnICsgJyAnICsgY2VpbCA6ICcnKSArXG4gICAgICAgICAgICAgICAgICAgICcgKHZhbiAnICsgdG90YWwgKyAnIHdlYnNpdGVzKSc7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLnBhZ2luYXRpb25UZXh0ID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS53ZWJzaXRlcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICh2bS53ZWJzaXRlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBzZXRSYW5kb21TaXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBmdW5jdGlvbiBzZXRSYW5kb21TaXRlKCkge1xuICAgICAgICAgICAgd2hpbGUgKCF2bS5yYW5kb21TaXRlIHx8ICF2bS5yYW5kb21TaXRlLmltYWdlKSB7XG4gICAgICAgICAgICAgICAgcm5kID0gTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIHZtLndlYnNpdGVzLmxlbmd0aCkpO1xuICAgICAgICAgICAgICAgIHZtLnJhbmRvbVNpdGUgPSB2bS53ZWJzaXRlc1tybmRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZtLnJhbmRvbVNpdGU7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIi8qKlxuICogUk9VVEVTOiBub3Rvcy5kYXNoYm9hcmRcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmRhc2hib2FyZCcpXG4gICAgICAgIC5ydW4oY29uZmlnUm91dGVzKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIGNvbmZpZ1JvdXRlcyhyb3V0ZWhlbHBlcikge1xuICAgICAgICByb3V0ZWhlbHBlci5jb25maWd1cmVTdGF0ZXMoZ2V0U3RhdGVzKCkpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBnZXRTdGF0ZXMoKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc3RhdGU6ICdpbmRleCcsXG4gICAgICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvaW5kZXgnLFxuICAgICAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ21haW5AJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnanMvbW9kdWxlcy9sYXlvdXQvbWFpbi5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ3N0YXJ0J1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgc3RhdGU6ICdpbmRleC5kYXNoYm9hcmQnLFxuICAgICAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvZGFzaGJvYXJkJyxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdjb250ZW50QGluZGV4Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnanMvbW9kdWxlcy9kYXNoYm9hcmQvZGFzaGJvYXJkLmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdEYXNoYm9hcmRDb250cm9sbGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdEYXNoYm9hcmQnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICBdO1xuICAgIH07XG59KSgpOyIsIi8qKlxuICogbm90b3MuZGF0YVxuICogRklMVEVSOiBIaWdobGlnaHRcbiAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmRhdGEnKVxuICAgICAgICAuZmlsdGVyKCdIaWdobGlnaHQnLCBIaWdobGlnaHQpO1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBIaWdobGlnaHQoJHNjZSkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHN0ciwgdGVybXNUb0hpZ2hsaWdodCkge1xuICAgICAgICAgICAgaWYgKHRlcm1zVG9IaWdobGlnaHQgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwoc3RyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFNvcnQgdGVybXMgYnkgbGVuZ3RoXG4gICAgICAgICAgICB0ZXJtc1RvSGlnaGxpZ2h0ID0gdGVybXNUb0hpZ2hsaWdodC5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICB0ZXJtc1RvSGlnaGxpZ2h0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYi5sZW5ndGggLSBhLmxlbmd0aDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBSZWdleCB0byBzaW11bHRhbmVvdXNseSByZXBsYWNlIHRlcm1zXG4gICAgICAgICAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKCcoPyE8W14+XSo/PiknICsgdGVybXNUb0hpZ2hsaWdodC5qb2luKCd8JykgKyAnKD8hW148XSo/PC9bXj5dKj8+KScsICdnaScpO1xuICAgICAgICAgICAgcmV0dXJuICRzY2UudHJ1c3RBc0h0bWwoc3RyLnJlcGxhY2UocmVnZXgsICc8c3BhbiBjbGFzcz1cIm1hdGNoXCI+JCY8L3NwYW4+JykpO1xuICAgICAgICB9O1xuICAgIH1cblxufSkoKTsiLCIvKipcbiAqIG5vdG9zLmRhdGFcbiAqIEZBQ1RPUlk6IEhUVFBDYWNoZVxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5kYXRhJylcbiAgICAgICAgLmZhY3RvcnkoJ0hUVFBDYWNoZScsIEhUVFBDYWNoZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBIVFRQQ2FjaGUoUmVzdGFuZ3VsYXIsICRjYWNoZUZhY3RvcnkpIHtcbiAgICAgICAgdmFyIGNhY2hlO1xuICAgICAgICBjYWNoZSA9ICRjYWNoZUZhY3RvcnkoJ2h0dHAnKTtcblxuICAgICAgICByZXR1cm4gUmVzdGFuZ3VsYXIud2l0aENvbmZpZyhmdW5jdGlvbiAoUmVzdGFuZ3VsYXJDb25maWd1cmVyKSB7XG4gICAgICAgICAgICBSZXN0YW5ndWxhckNvbmZpZ3VyZXIuc2V0RGVmYXVsdEh0dHBGaWVsZHMoe2NhY2hlOiBjYWNoZX0pO1xuICAgICAgICAgICAgUmVzdGFuZ3VsYXJDb25maWd1cmVyLnNldFJlc3BvbnNlSW50ZXJjZXB0b3IoZnVuY3Rpb24gKHJlc3BvbnNlLCBvcGVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBpZiAob3BlcmF0aW9uID09PSAncHV0JyB8fCBvcGVyYXRpb24gPT09ICdwb3N0JyB8fCBvcGVyYXRpb24gPT09ICdkZWxldGUnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlLnJlbW92ZUFsbCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gQ3VzdG9tIEdsb2JhbCBNZXRob2QocykgZm9yIFJlc3Rhbmd1bGFyaXplZCBFbGVtZW50cy5cbiAgICAgICAgICAgIFJlc3Rhbmd1bGFyQ29uZmlndXJlci5zZXRPbkVsZW1SZXN0YW5ndWxhcml6ZWQoZnVuY3Rpb24oZWxlbSwgaXNDb2xsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgZWxlbS5jbGVhckNhY2hlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlLnJlbW92ZUFsbCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59KSgpOyIsIi8qKlxuICogbm90b3MuZmlsdGVyXG4gKiBGQUNUT1JZOiBMZXZlbFxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5maWx0ZXInKVxuICAgICAgICAuZmFjdG9yeSgnTGV2ZWwnLCBMZXZlbCk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBMZXZlbChIVFRQQ2FjaGUpIHtcbiAgICAgICAgdmFyIHNlcnZpY2UgPSBIVFRQQ2FjaGUuc2VydmljZSgnZ3JvdXAnKS5vbmUoJ2xldmVscycpO1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gICAgfVxufSkoKTsiLCIvKipcbiAqIG5vdG9zLmZpbHRlclxuICogRkFDVE9SWTogVGFnXG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ25vdG9zLmZpbHRlcicpXG4gICAgICAgIC5mYWN0b3J5KCdUYWcnLCBUYWcpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gVGFnKEhUVFBDYWNoZSkge1xuICAgICAgICB2YXIgc2VydmljZSA9IEhUVFBDYWNoZS5zZXJ2aWNlKCd0YWdzJyk7XG5cbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgfVxufSkoKTsiLCIvKipcbiAqIG5vdG9zLmxheW91dFxuICogQ09OVFJPTExFUjogU2hlbGxDb250cm9sbGVyXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy5sYXlvdXQnKVxuICAgICAgICAuY29udHJvbGxlcignU2hlbGxDb250cm9sbGVyJywgU2hlbGxDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIFNoZWxsQ29udHJvbGxlcigpIHtcbiAgICAgICAgLypqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cblxuICAgICAgICBhY3RpdmF0ZSgpO1xuICAgICAgICAvLy8vLy8vLy8vLy8vXG5cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICB9XG5cblxuICAgIH1cblxuXG59KSgpOyIsIi8qKlxuICogbm90b3Mud2Vic2l0ZXNcbiAqIEZJTFRFUjogU2VhcmNoV2Vic2l0ZVxuICovXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnbm90b3Mud2Vic2l0ZXMnKVxuICAgICAgICAuZmlsdGVyKCdTZWFyY2hXZWJzaXRlJywgU2VhcmNoV2Vic2l0ZSk7XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIFNlYXJjaFdlYnNpdGUoXykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHdlYnNpdGVzLCBmaWx0ZXIpIHtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZCA9IFtdO1xuICAgICAgICAgICAgdmFyIHRlcm1zID0gZmlsdGVyLnRlcm1zID09PSAnJyA/IG51bGwgOiBmaWx0ZXIudGVybXMuc3BsaXQoJyAnKTtcbiAgICAgICAgICAgIHZhciB0YWdzID0gZmlsdGVyLnRhZ3M7XG4gICAgICAgICAgICB2YXIgbGV2ZWxzID0gZmlsdGVyLmxldmVscztcblxuICAgICAgICAgICAgdmFyIHRtcCA9IFtdO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2god2Vic2l0ZXMsIGZ1bmN0aW9uICh3ZWJzaXRlKSB7XG4gICAgICAgICAgICAgICAgLy9GSVJTVCBmaWx0ZXIgYnkgVGFncyBBTkQgTGV2ZWxzIChBTkQgb3BlcmF0b3IpXG4gICAgICAgICAgICAgICAgLy9jaGVjayB0YWdzXG4gICAgICAgICAgICAgICAgaWYgKHRhZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3ZWJzaXRlLnRhZ3MsIGZ1bmN0aW9uICh0YWcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdGFnIHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXy5zb21lKHRhZ3MsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0LmlkID09PSB0YWcuaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRVbmlxdWUod2Vic2l0ZSwgdG1wKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHdlYnNpdGVzID0gdGFncy5sZW5ndGggPyB0bXAgOiB3ZWJzaXRlcztcbiAgICAgICAgICAgIGlmIChsZXZlbHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdG1wID0gW107XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHdlYnNpdGVzLCBmdW5jdGlvbiAod2Vic2l0ZSkge1xuICAgICAgICAgICAgICAgICAgICAvL2NoZWNrIG9iamVjdGl2ZSBsZXZlbHNcblxuICAgICAgICAgICAgICAgICAgICBpZiAoXy5hbnkobGV2ZWxzLCBmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5hbnkod2Vic2l0ZS5vYmplY3RpdmVzLCBmdW5jdGlvbiAob2JqZWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfLnNvbWUob2JqZWN0aXZlLmxldmVscywgZnVuY3Rpb24gKGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsLmxldmVsID4gMCAmJiBsLmdyb3VwLmlkID09PSBsZXZlbC5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRVbmlxdWUod2Vic2l0ZSwgdG1wKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL1dpdGhpbiB0aGVzZSByZXN1bHRzIGZpbHRlciBieSB0ZXJtcyAoT1Igb3BlcmF0b3IpXG4gICAgICAgICAgICB3ZWJzaXRlcyA9IHRhZ3MubGVuZ3RoIHx8IGxldmVscy5sZW5ndGggPyB0bXAgOiB3ZWJzaXRlcztcbiAgICAgICAgICAgIGlmICh0ZXJtcykge1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3ZWJzaXRlcywgZnVuY3Rpb24gKHdlYnNpdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgbmFtZSBhbmQgZGVzY3JpcHRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfLnNvbWUodGVybXMsIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYW1lQ29udGFpbnNUZXJtKHdlYnNpdGUubmFtZSwgdCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uQ29udGFpbnNUZXJtKHdlYnNpdGUuZGVzY3JpcHRpb24sIHQpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RpdmVzQ29udGFpbnNUZXJtKHdlYnNpdGUub2JqZWN0aXZlcywgdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRVbmlxdWUod2Vic2l0ZSwgZmlsdGVyZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWQgPSB0bXA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJlZDtcblxuICAgICAgICAgICAgZnVuY3Rpb24gYWRkVW5pcXVlKHdlYnNpdGUsIGxpc3QpIHtcbiAgICAgICAgICAgICAgICBpZiAobGlzdC5pbmRleE9mKHdlYnNpdGUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LnB1c2god2Vic2l0ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBuYW1lQ29udGFpbnNUZXJtKG5hbWUsIHRlcm0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmFtZSAmJiBfLmNvbnRhaW5zKG5hbWUudG9Mb3dlckNhc2UoKSwgdGVybS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZGVzY3JpcHRpb25Db250YWluc1Rlcm0oZGVzY3JpcHRpb24sIHRlcm0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVzY3JpcHRpb24gJiYgXy5jb250YWlucyhkZXNjcmlwdGlvbi50b0xvd2VyQ2FzZSgpLCB0ZXJtLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBvYmplY3RpdmVzQ29udGFpbnNUZXJtKG9iamVjdGl2ZXMsIHRlcm0pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXy5zb21lKG9iamVjdGl2ZXMsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvICYmIChfLmNvbnRhaW5zKG8uY29kZS50b0xvd2VyQ2FzZSgpLCB0ZXJtLnRvTG93ZXJDYXNlKCkpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmNvbnRhaW5zKG8ubmFtZS50b0xvd2VyQ2FzZSgpLCB0ZXJtLnRvTG93ZXJDYXNlKCkpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICB9XG59KVxuKCk7IiwiLyoqXG4gKiBub3Rvcy53ZWJzaXRlc1xuICogRkFDVE9SWTogV2Vic2l0ZVxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy53ZWJzaXRlcycpXG4gICAgICAgIC5mYWN0b3J5KCdXZWJzaXRlJywgV2Vic2l0ZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBXZWJzaXRlKEhUVFBDYWNoZSkge1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgZnVsbDogZnVsbCxcbiAgICAgICAgICAgIGdldExpc3Q6IGdldExpc3RcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldExpc3QoKSB7XG4gICAgICAgICAgICByZXR1cm4gSFRUUENhY2hlLnNlcnZpY2UoJ3dlYnNpdGVzJykuZ2V0TGlzdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZnVsbCgpIHtcbiAgICAgICAgICAgIHJldHVybiBIVFRQQ2FjaGUuc2VydmljZSgnd2Vic2l0ZXMnKS5vbmUoJ2Z1bGwnKS5nZXRMaXN0KCk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIi8vIEluY2x1ZGUgaW4gaW5kZXguaHRtbCBzbyB0aGF0IGFwcCBsZXZlbCBleGNlcHRpb25zIGFyZSBoYW5kbGVkLlxuLy8gRXhjbHVkZSBmcm9tIHRlc3RSdW5uZXIuaHRtbCB3aGljaCBzaG91bGQgcnVuIGV4YWN0bHkgd2hhdCBpdCB3YW50cyB0byBydW5cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2Jsb2Nrcy5leGNlcHRpb24nKVxuICAgICAgICAucHJvdmlkZXIoJ2V4Y2VwdGlvbkhhbmRsZXInLCBleGNlcHRpb25IYW5kbGVyUHJvdmlkZXIpXG4gICAgICAgIC5jb25maWcoY29uZmlnKTtcblxuICAgIC8qKlxuICAgICAqIE11c3QgY29uZmlndXJlIHRoZSBleGNlcHRpb24gaGFuZGxpbmdcbiAgICAgKiBAcmV0dXJuIHtbdHlwZV19XG4gICAgICovXG4gICAgZnVuY3Rpb24gZXhjZXB0aW9uSGFuZGxlclByb3ZpZGVyKCkge1xuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cbiAgICAgICAgdGhpcy5jb25maWcgPSB7XG4gICAgICAgICAgICBhcHBFcnJvclByZWZpeDogdW5kZWZpbmVkXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5jb25maWd1cmUgPSBmdW5jdGlvbiAoYXBwRXJyb3JQcmVmaXgpIHtcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmFwcEVycm9yUHJlZml4ID0gYXBwRXJyb3JQcmVmaXg7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy4kZ2V0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4ge2NvbmZpZzogdGhpcy5jb25maWd9O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbmZpZ3VyZSBieSBzZXR0aW5nIGFuIG9wdGlvbmFsIHN0cmluZyB2YWx1ZSBmb3IgYXBwRXJyb3JQcmVmaXguXG4gICAgICogQWNjZXNzaWJsZSB2aWEgY29uZmlnLmFwcEVycm9yUHJlZml4ICh2aWEgY29uZmlnIHZhbHVlKS5cbiAgICAgKiBAcGFyYW0gIHtbdHlwZV19ICRwcm92aWRlXG4gICAgICogQHJldHVybiB7W3R5cGVdfVxuICAgICAqIEBuZ0luamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNvbmZpZygkcHJvdmlkZSkge1xuICAgICAgICAkcHJvdmlkZS5kZWNvcmF0b3IoJyRleGNlcHRpb25IYW5kbGVyJywgZXh0ZW5kRXhjZXB0aW9uSGFuZGxlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXh0ZW5kIHRoZSAkZXhjZXB0aW9uSGFuZGxlciBzZXJ2aWNlIHRvIGFsc28gZGlzcGxheSBhIHRvYXN0LlxuICAgICAqIEBwYXJhbSAge09iamVjdH0gJGRlbGVnYXRlXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBleGNlcHRpb25IYW5kbGVyXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBsb2dnZXJcbiAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gdGhlIGRlY29yYXRlZCAkZXhjZXB0aW9uSGFuZGxlciBzZXJ2aWNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gZXh0ZW5kRXhjZXB0aW9uSGFuZGxlcigkZGVsZWdhdGUsIGV4Y2VwdGlvbkhhbmRsZXIsIGxvZ2dlcikge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXhjZXB0aW9uLCBjYXVzZSkge1xuICAgICAgICAgICAgdmFyIGFwcEVycm9yUHJlZml4ID0gZXhjZXB0aW9uSGFuZGxlci5jb25maWcuYXBwRXJyb3JQcmVmaXggfHwgJyc7XG4gICAgICAgICAgICB2YXIgZXJyb3JEYXRhID0ge2V4Y2VwdGlvbjogZXhjZXB0aW9uLCBjYXVzZTogY2F1c2V9O1xuICAgICAgICAgICAgZXhjZXB0aW9uLm1lc3NhZ2UgPSBhcHBFcnJvclByZWZpeCArIGV4Y2VwdGlvbi5tZXNzYWdlO1xuICAgICAgICAgICAgJGRlbGVnYXRlKGV4Y2VwdGlvbiwgY2F1c2UpO1xuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBDb3VsZCBhZGQgdGhlIGVycm9yIHRvIGEgc2VydmljZSdzIGNvbGxlY3Rpb24sXG4gICAgICAgICAgICAgKiBhZGQgZXJyb3JzIHRvICRyb290U2NvcGUsIGxvZyBlcnJvcnMgdG8gcmVtb3RlIHdlYiBzZXJ2ZXIsXG4gICAgICAgICAgICAgKiBvciBsb2cgbG9jYWxseS4gT3IgdGhyb3cgaGFyZC4gSXQgaXMgZW50aXJlbHkgdXAgdG8geW91LlxuICAgICAgICAgICAgICogdGhyb3cgZXhjZXB0aW9uO1xuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqIEBleGFtcGxlXG4gICAgICAgICAgICAgKiAgICAgdGhyb3cgeyBtZXNzYWdlOiAnZXJyb3IgbWVzc2FnZSB3ZSBhZGRlZCcgfTtcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGV4Y2VwdGlvbi5tZXNzYWdlLCBlcnJvckRhdGEpO1xuICAgICAgICB9O1xuICAgIH1cbn0pKCk7IiwiLyoqXG4gKiBibG9ja3MuZXhjZXB0aW9uXG4gKiBGQUNUT1JZOiBleGNlcHRpb25cbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicpXG4gICAgICAgIC5mYWN0b3J5KCdleGNlcHRpb24nLCBleGNlcHRpb24pO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gZXhjZXB0aW9uKGxvZ2dlcikge1xuICAgICAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgICAgICAgIGNhdGNoZXI6IGNhdGNoZXJcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XG5cbiAgICAgICAgZnVuY3Rpb24gY2F0Y2hlcihtZXNzYWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24ocmVhc29uKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG1lc3NhZ2UsIHJlYXNvbik7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIvKipcbiAqIGJsb2Nrcy5sb2dnZXJcbiAqIEZBQ1RPUlk6IGxvZ2dlclxuICovXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdibG9ja3MubG9nZ2VyJylcbiAgICAgICAgLmZhY3RvcnkoJ2xvZ2dlcicsIGxvZ2dlcik7XG5cbiAgICBsb2dnZXIuJGluamVjdCA9IFsnJGxvZycsICd0b2FzdHInXTtcblxuICAgIGZ1bmN0aW9uIGxvZ2dlcigkbG9nLCB0b2FzdHIpIHtcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICAgICAgICBzaG93VG9hc3RzOiB0cnVlLFxuXG4gICAgICAgICAgICBlcnJvcjogZXJyb3IsXG4gICAgICAgICAgICBpbmZvOiBpbmZvLFxuICAgICAgICAgICAgc3VjY2Vzczogc3VjY2VzcyxcbiAgICAgICAgICAgIHdhcm5pbmc6IHdhcm5pbmcsXG5cbiAgICAgICAgICAgIHJlbW92ZWQ6IHJlbW92ZWQsXG4gICAgICAgICAgICBzYXZlZDogc2F2ZWQsXG5cbiAgICAgICAgICAgIC8vIHN0cmFpZ2h0IHRvIGNvbnNvbGU7IGJ5cGFzcyB0b2FzdHJcbiAgICAgICAgICAgIGxvZzogJGxvZy5sb2dcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gc2VydmljZTtcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZXJyb3IobWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcbiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihtZXNzYWdlLCB0aXRsZSk7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdGb3V0OiAnICsgbWVzc2FnZSwgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbmZvKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XG4gICAgICAgICAgICB0b2FzdHIuaW5mbyhtZXNzYWdlLCB0aXRsZSk7XG4gICAgICAgICAgICAkbG9nLmluZm8oJ0luZm86ICcgKyBtZXNzYWdlLCBkYXRhKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MobWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcbiAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKG1lc3NhZ2UsIHRpdGxlKTtcbiAgICAgICAgICAgICRsb2cuaW5mbygnU3VjY2VzOiAnICsgbWVzc2FnZSwgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB3YXJuaW5nKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XG4gICAgICAgICAgICB0b2FzdHIud2FybmluZyhtZXNzYWdlLCB0aXRsZSk7XG4gICAgICAgICAgICAkbG9nLndhcm4oJ0xldCBvcDogJyArIG1lc3NhZ2UsIGRhdGEpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlZChtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xuICAgICAgICAgICAgdG9hc3RyLndhcm5pbmcobWVzc2FnZSwgdGl0bGUpO1xuICAgICAgICAgICAgJGxvZy53YXJuKCdWZXJ3aWpkZXJkOiAnICsgbWVzc2FnZSwgZGF0YSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzYXZlZChtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xuICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MobWVzc2FnZSwgdGl0bGUpO1xuICAgICAgICAgICAgJGxvZy5pbmZvKCdCZXdhYXJkOiAnICsgbWVzc2FnZSwgZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIi8qKlxuICogbm90b3NwbHVzLnJvdXRlclxuICogRkFDVE9SWTogcm91dGVoZWxwZXJcbiAqL1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLnJvdXRlcicpXG4gICAgICAgIC5wcm92aWRlcigncm91dGVoZWxwZXJDb25maWcnLCByb3V0ZWhlbHBlckNvbmZpZylcbiAgICAgICAgLmZhY3RvcnkoJ3JvdXRlaGVscGVyJywgcm91dGVoZWxwZXIpO1xuXG4gICAgcm91dGVoZWxwZXIuJGluamVjdCA9IFsncm91dGVoZWxwZXJDb25maWcnLCAnJHJvb3RTY29wZScsICckc3RhdGUnXTtcblxuICAgIGZ1bmN0aW9uIHJvdXRlaGVscGVyQ29uZmlnKCkge1xuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cbiAgICAgICAgdGhpcy5jb25maWcgPSB7fTtcblxuICAgICAgICB0aGlzLiRnZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGNvbmZpZzogdGhpcy5jb25maWdcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcm91dGVoZWxwZXIocm91dGVoZWxwZXJDb25maWcsICRyb290U2NvcGUsICRzdGF0ZSkge1xuICAgICAgICB2YXIgJHVybFJvdXRlclByb3ZpZGVyID0gcm91dGVoZWxwZXJDb25maWcuY29uZmlnLiR1cmxSb3V0ZXJQcm92aWRlcjtcbiAgICAgICAgdmFyICRzdGF0ZVByb3ZpZGVyID0gcm91dGVoZWxwZXJDb25maWcuY29uZmlnLiRzdGF0ZVByb3ZpZGVyO1xuXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgICAgICAgY29uZmlndXJlU3RhdGVzOiBjb25maWd1cmVTdGF0ZXMsXG4gICAgICAgICAgICBzdGF0ZXM6IHN0YXRlcyxcbiAgICAgICAgICAgIGdldDogZ2V0XG4gICAgICAgIH07XG5cbiAgICAgICAgaW5pdCgpO1xuXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBjb25maWd1cmVTdGF0ZXMoc3RhdGVzKSB7XG4gICAgICAgICAgICBzdGF0ZXMuZm9yRWFjaChmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuY29uZmlnLnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLmNvbmZpZy5uY3lCcmVhZGNydW1iID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHN0YXRlLmNvbmZpZy50aXRsZS50b0xvd2VyQ2FzZSgpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkc3RhdGVQcm92aWRlci5zdGF0ZShzdGF0ZS5zdGF0ZSwgc3RhdGUuY29uZmlnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3RhdGVzKCkge1xuICAgICAgICAgICAgcmV0dXJuICRzdGF0ZS5nZXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldChwYXR0ZXJuKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcbiAgICAgICAgICAgIHN0YXRlcygpLmZvckVhY2goZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXRlLm5hbWUgPT09IHBhdHRlcm4pIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc3RhdGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgICAgIHVwZGF0ZURvY1RpdGxlKCk7XG4gICAgICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvaW5kZXgvZGFzaGJvYXJkJyk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVEb2NUaXRsZSgpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJyxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXZlbnQsIGN1cnJlbnQsIHByZXZpb3VzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9IHJvdXRlaGVscGVyQ29uZmlnLmNvbmZpZy50aXRsZSArIChjdXJyZW50LnRpdGxlID8gJyB8ICcgKyBjdXJyZW50LnRpdGxlIDogJycpO1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnRpdGxlID0gdGl0bGU7IC8vIGRhdGEgYmluZCB0byA8dGl0bGU+XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJHN0YXRlID0gY3VycmVudDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIi8qKlxuICogbm90b3Mud2lkZ2V0c1xuICogRElSRUNUSVZFOiBudEZhXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy53aWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnbnRGYScsIG50RmEpO1xuXG4gICAgbnRGYS4kaW5qZWN0ID0gW107XG5cbiAgICBmdW5jdGlvbiBudEZhKCkge1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmtGdW5jXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtGdW5jKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgdmFyIGkgPSBhbmd1bGFyLmVsZW1lbnQoJzxpIGNsYXNzPVwiZmFcIiAvPicpO1xuICAgICAgICAgICAgdmFyIGNsYXNzZXMgPSBhdHRycy5uYW1lLnNwbGl0KCcgJyk7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChjbGFzc2VzLCBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpLmFkZENsYXNzKCdmYS0nICsgdmFsdWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQucmVwbGFjZVdpdGgoaSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuXG4iLCIvKipcbiAqIG5vdG9zLndpZGdldHNcbiAqIERJUkVDVElWRTogbnRQYWdpbmF0aW9uXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy53aWRnZXRzJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnbnRQYWdpbmF0aW9uJywgbnRQYWdpbmF0aW9uKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIG50UGFnaW5hdGlvbigkY29tcGlsZSkge1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIHRvdGFsSXRlbXM6ICc9JyxcbiAgICAgICAgICAgICAgICBpdGVtc1BlclBhZ2U6ICc9JyxcbiAgICAgICAgICAgICAgICBjdXJyZW50UGFnZTogJz0nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbGluazogbGlua0Z1bmMsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBQYWdpbmF0ZUNvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlIC8vIGJlY2F1c2UgdGhlIHNjb3BlIGlzIGlzb2xhdGVkXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmtGdW5jKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICAgICAgdmFyIHBhZ2luYXRpb24gPSBhbmd1bGFyLmVsZW1lbnQoJzxwYWdpbmF0aW9uIC8+JylcbiAgICAgICAgICAgIHBhZ2luYXRpb24uYXR0cignZGF0YS1ib3VuZGFyeS1saW5rcycsIHRydWUpO1xuICAgICAgICAgICAgcGFnaW5hdGlvbi5hdHRyKCdkYXRhLXRvdGFsLWl0ZW1zJywgJ3RvdGFsSXRlbXMnKTtcbiAgICAgICAgICAgIHBhZ2luYXRpb24uYXR0cignZGF0YS1pdGVtcy1wZXItcGFnZScsICdpdGVtc1BlclBhZ2UnKTtcbiAgICAgICAgICAgIHBhZ2luYXRpb24uYXR0cignZGF0YS1tYXgtc2l6ZScsIDUpO1xuICAgICAgICAgICAgcGFnaW5hdGlvbi5hdHRyKCdkYXRhLW5nLW1vZGVsJywgJ2N1cnJlbnRQYWdlJyk7XG4gICAgICAgICAgICBwYWdpbmF0aW9uLmF0dHIoJ2RhdGEtcHJldmlvdXMtdGV4dCcsICfigLknKTtcbiAgICAgICAgICAgIHBhZ2luYXRpb24uYXR0cignZGF0YS1uZXh0LXRleHQnLCAn4oC6Jyk7XG4gICAgICAgICAgICBwYWdpbmF0aW9uLmF0dHIoJ2RhdGEtZmlyc3QtdGV4dCcsICfCqycpO1xuICAgICAgICAgICAgcGFnaW5hdGlvbi5hdHRyKCdkYXRhLWxhc3QtdGV4dCcsICfCuycpO1xuICAgICAgICAgICAgcGFnaW5hdGlvbi5hdHRyKCdkYXRhLW5nLWhpZGUnLCAnaGlkZScpO1xuICAgICAgICAgICAgaWYgKGF0dHJzWydjbGFzcyddKSB7XG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvbi5hdHRyKCdjbGFzcycsIGF0dHJzWydjbGFzcyddKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJGNvbXBpbGUocGFnaW5hdGlvbikoc2NvcGUpO1xuICAgICAgICAgICAgZWxlbWVudC5yZXBsYWNlV2l0aChwYWdpbmF0aW9uKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qIEBuZ0luamVjdCAqL1xuICAgICAgICBmdW5jdGlvbiBQYWdpbmF0ZUNvbnRyb2xsZXIoJHNjb3BlKSB7XG4gICAgICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgICAgICB2bS5oaWRlID0gZmFsc2U7XG4gICAgICAgICAgICB2bS5pdGVtc1BlclBhZ2UgPSAxMDtcbiAgICAgICAgICAgIHZtLmN1cnJlbnRQZ2UgPSAwO1xuXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS50b3RhbEl0ZW1zJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZtLmhpZGUgPSAodm0udG90YWxJdGVtcyA8PSB2bS5pdGVtc1BlclBhZ2UpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuXG4iLCIvKipcbiAqIG5vdG9zLndpZGdldHNcbiAqIEZJTFRFUjogb2Zmc2V0XG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdub3Rvcy53aWRnZXRzJylcbiAgICAgICAgLmZpbHRlcignb2Zmc2V0JywgZmlsdGVyKTtcblxuXG4gICAgZnVuY3Rpb24gZmlsdGVyKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gb2Zmc2V0KGlucHV0LCBzdGFydCkge1xuICAgICAgICAgICAgaWYgKGlucHV0KSB7XG4gICAgICAgICAgICAgICAgc3RhcnQgPSBwYXJzZUludChzdGFydCwgMTApO1xuICAgICAgICAgICAgICAgIHJldHVybiBpbnB1dC5zbGljZShzdGFydCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH07XG4gICAgfVxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=